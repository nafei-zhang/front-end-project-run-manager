{"version":3,"file":"main.js","sources":["../electron/services/ProjectManager.ts","../electron/services/ProcessManager.ts","../electron/services/LogManager.ts","../electron/services/ConfigManager.ts","../electron/main.ts"],"sourcesContent":["import { readFileSync, writeFileSync, existsSync } from 'fs'\r\nimport { join } from 'path'\r\nimport { app } from 'electron'\r\nimport { randomUUID } from 'crypto'\r\n\r\nexport interface Project {\r\n  id: string\r\n  name: string\r\n  path: string\r\n  packageManager: 'npm' | 'pnpm' | 'yarn'\r\n  startCommand: string\r\n  status: 'stopped' | 'running' | 'error'\r\n  port?: number\r\n  pid?: number\r\n  url?: string  // 添加 URL 字段\r\n  autoRefreshLogs?: boolean  // 添加自动刷新日志字段\r\n  createdAt: string\r\n  updatedAt: string\r\n}\r\n\r\nexport interface CreateProjectData {\r\n  name: string\r\n  path: string\r\n  packageManager: 'npm' | 'pnpm' | 'yarn'\r\n  startCommand?: string\r\n}\r\n\r\ninterface ProjectsData {\r\n  projects: Project[]\r\n}\r\n\r\nexport class ProjectManager {\r\n  private projectsFilePath: string\r\n  private projects: Project[] = []\r\n\r\n  constructor() {\r\n    this.projectsFilePath = join(app.getPath('userData'), 'projects.json')\r\n    this.loadProjects()\r\n  }\r\n\r\n  private loadProjects(): void {\r\n    try {\r\n      if (existsSync(this.projectsFilePath)) {\r\n        const data = readFileSync(this.projectsFilePath, 'utf-8')\r\n        const projectsData: ProjectsData = JSON.parse(data)\r\n        this.projects = projectsData.projects || []\r\n      } else {\r\n        this.projects = []\r\n        this.saveProjects()\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load projects:', error)\r\n      this.projects = []\r\n    }\r\n  }\r\n\r\n  private saveProjects(): void {\r\n    console.log('[ProjectManager] saveProjects called, projects to save:', this.projects.length)\r\n    console.log('[ProjectManager] Projects data:', this.projects)\r\n    console.log('[ProjectManager] Saving to file:', this.projectsFilePath)\r\n    try {\r\n      const data: ProjectsData = { projects: this.projects }\r\n      writeFileSync(this.projectsFilePath, JSON.stringify(data, null, 2))\r\n      console.log('[ProjectManager] Successfully saved projects to file')\r\n    } catch (error) {\r\n      console.error('[ProjectManager] Failed to save projects:', error)\r\n    }\r\n  }\r\n\r\n  getAllProjects(): Project[] {\r\n    console.log('[ProjectManager] getAllProjects called, returning:', this.projects.length, 'projects')\r\n    return [...this.projects]\r\n  }\r\n\r\n  getProject(id: string): Project | undefined {\r\n    return this.projects.find(project => project.id === id)\r\n  }\r\n\r\n  createProject(projectData: CreateProjectData): Project {\r\n    console.log('[ProjectManager] createProject called with data:', projectData)\r\n    const now = new Date().toISOString()\r\n    \r\n    // 优先使用用户提供的启动命令\r\n    let startCommand = projectData.startCommand\r\n    \r\n    // 只有当用户未提供启动命令时，才尝试自动检测\r\n    if (!startCommand) {\r\n      startCommand = 'dev' // 默认值\r\n      \r\n      // 尝试读取 package.json 来检测可用的脚本\r\n      try {\r\n        const packageJsonPath = join(projectData.path, 'package.json')\r\n        console.log('[ProjectManager] Checking package.json at:', packageJsonPath)\r\n        if (existsSync(packageJsonPath)) {\r\n          const packageJson = JSON.parse(readFileSync(packageJsonPath, 'utf-8'))\r\n          const scripts = packageJson.scripts || {}\r\n          console.log('[ProjectManager] Found scripts:', scripts)\r\n          \r\n          // 优先级：dev > start > serve\r\n          if (scripts.dev) {\r\n            startCommand = 'dev'\r\n          } else if (scripts.start) {\r\n            startCommand = 'start'\r\n          } else if (scripts.serve) {\r\n            startCommand = 'serve'\r\n          }\r\n        } else {\r\n          console.log('[ProjectManager] package.json not found at path')\r\n        }\r\n      } catch (error) {\r\n        console.warn('[ProjectManager] Failed to read package.json:', error)\r\n      }\r\n    } else {\r\n      console.log('[ProjectManager] Using user-provided startCommand:', startCommand)\r\n    }\r\n\r\n    const project: Project = {\r\n      id: randomUUID(),\r\n      name: projectData.name,\r\n      path: projectData.path,\r\n      packageManager: projectData.packageManager,\r\n      startCommand,\r\n      status: 'stopped',\r\n      createdAt: now,\r\n      updatedAt: now\r\n    }\r\n\r\n    console.log('[ProjectManager] Created project object:', project)\r\n    console.log('[ProjectManager] Current projects count before add:', this.projects.length)\r\n    \r\n    this.projects.push(project)\r\n    console.log('[ProjectManager] Current projects count after add:', this.projects.length)\r\n    \r\n    console.log('[ProjectManager] Calling saveProjects...')\r\n    this.saveProjects()\r\n    console.log('[ProjectManager] saveProjects completed')\r\n    \r\n    return project\r\n  }\r\n\r\n  updateProject(id: string, updates: Partial<Project>): Project | null {\r\n    const projectIndex = this.projects.findIndex(project => project.id === id)\r\n    if (projectIndex === -1) return null\r\n\r\n    this.projects[projectIndex] = {\r\n      ...this.projects[projectIndex],\r\n      ...updates,\r\n      updatedAt: new Date().toISOString()\r\n    }\r\n\r\n    this.saveProjects()\r\n    return this.projects[projectIndex]\r\n  }\r\n\r\n  // 新增：重置所有项目状态为停止状态（应用启动时调用）\r\n  resetAllProjectsToStopped(): void {\r\n    console.log('[ProjectManager] Resetting all projects to stopped status')\r\n    let hasChanges = false\r\n    \r\n    this.projects.forEach(project => {\r\n      if (project.status === 'running' || project.pid || project.url) {\r\n        console.log('[ProjectManager] Resetting project:', project.id, project.name)\r\n        project.status = 'stopped'\r\n        project.pid = undefined\r\n        project.url = undefined  // 清除 URL\r\n        project.port = undefined  // 清除端口\r\n        project.updatedAt = new Date().toISOString()\r\n        hasChanges = true\r\n      }\r\n    })\r\n    \r\n    if (hasChanges) {\r\n      console.log('[ProjectManager] Saving updated project states')\r\n      this.saveProjects()\r\n    } else {\r\n      console.log('[ProjectManager] No projects needed status reset')\r\n    }\r\n  }\r\n\r\n  deleteProject(id: string): boolean {\r\n    const projectIndex = this.projects.findIndex(project => project.id === id)\r\n    \r\n    if (projectIndex === -1) {\r\n      return false\r\n    }\r\n\r\n    this.projects.splice(projectIndex, 1)\r\n    this.saveProjects()\r\n    \r\n    return true\r\n  }\r\n\r\n  // 检测项目的包管理器\r\n  detectPackageManager(projectPath: string): 'npm' | 'pnpm' | 'yarn' {\r\n    if (existsSync(join(projectPath, 'pnpm-lock.yaml'))) {\r\n      return 'pnpm'\r\n    }\r\n    if (existsSync(join(projectPath, 'yarn.lock'))) {\r\n      return 'yarn'\r\n    }\r\n    return 'npm'\r\n  }\r\n\r\n  // 验证项目路径\r\n  validateProjectPath(projectPath: string): boolean {\r\n    return existsSync(join(projectPath, 'package.json'))\r\n  }\r\n}","import { spawn, ChildProcess } from 'child_process'\r\nimport { Project } from './ProjectManager'\r\nimport { LogManager } from './LogManager'\r\n\r\nexport interface ProcessInfo {\r\n  projectId: string\r\n  process: ChildProcess\r\n  pid: number\r\n  startTime: Date\r\n}\r\n\r\nexport class ProcessManager {\r\n  private runningProcesses: Map<string, ProcessInfo> = new Map()\r\n  private logManager: LogManager\r\n  private onProjectStatusChange?: (projectId: string, status: 'running' | 'stopped') => void\r\n\r\n  constructor(logManager: LogManager) {\r\n    this.logManager = logManager\r\n  }\r\n\r\n  setProjectStatusChangeCallback(callback: (projectId: string, status: 'running' | 'stopped') => void): void {\r\n    this.onProjectStatusChange = callback\r\n  }\r\n\r\n  async startProject(project: Project): Promise<{ success: boolean; pid?: number; error?: string }> {\r\n    console.log('[ProcessManager] startProject called for project:', project.id, project.name)\r\n    \r\n    try {\r\n      // 检查项目是否已经在运行\r\n      if (this.runningProcesses.has(project.id)) {\r\n        console.log('[ProcessManager] Project is already running')\r\n        return { success: false, error: 'Project is already running' }\r\n      }\r\n\r\n      // 构建命令\r\n      const command = this.buildCommand(project.packageManager, project.startCommand)\r\n      console.log('[ProcessManager] Starting command:', command.cmd, command.args.join(' '))\r\n      console.log('[ProcessManager] Working directory:', project.path)\r\n      console.log('[ProcessManager] Environment NODE_ENV:', process.env.NODE_ENV || 'undefined')\r\n      \r\n      // 启动进程\r\n      const childProcess = spawn(command.cmd, command.args, {\r\n        cwd: project.path,\r\n        stdio: ['pipe', 'pipe', 'pipe'],\r\n        shell: true,\r\n        env: { \r\n          ...process.env, \r\n          FORCE_COLOR: '1',\r\n          // 确保 PATH 包含常见的 Node.js 和包管理器路径\r\n          PATH: this.getEnhancedPath()\r\n        }\r\n      })\r\n\r\n      if (!childProcess.pid) {\r\n        console.log('[ProcessManager] Failed to get PID from child process')\r\n        return { success: false, error: 'Failed to start process' }\r\n      }\r\n\r\n      console.log('[ProcessManager] Process started with PID:', childProcess.pid)\r\n\r\n      // 记录进程信息\r\n      const processInfo: ProcessInfo = {\r\n        projectId: project.id,\r\n        process: childProcess,\r\n        pid: childProcess.pid,\r\n        startTime: new Date()\r\n      }\r\n\r\n      this.runningProcesses.set(project.id, processInfo)\r\n      console.log('[ProcessManager] Added process to running processes list')\r\n      console.log('[ProcessManager] Current running processes:', Array.from(this.runningProcesses.keys()))\r\n\r\n      // 设置日志监听\r\n      this.setupLogListeners(project.id, childProcess)\r\n\r\n      // 监听进程退出\r\n      childProcess.on('exit', (code, signal) => {\r\n        console.log('[ProcessManager] Process exited:', project.id, 'code:', code, 'signal:', signal)\r\n        this.runningProcesses.delete(project.id)\r\n        console.log('[ProcessManager] Removed process from running list on exit')\r\n        this.logManager.addLog(project.id, {\r\n          timestamp: new Date().toISOString(),\r\n          level: code === 0 ? 'info' : 'error',\r\n          message: `Process exited with code ${code} ${signal ? `(${signal})` : ''}`\r\n        })\r\n      })\r\n\r\n      childProcess.on('error', (error) => {\r\n        console.log('[ProcessManager] Process error:', project.id, error.message)\r\n        this.runningProcesses.delete(project.id)\r\n        console.log('[ProcessManager] Removed process from running list on error')\r\n        this.logManager.addLog(project.id, {\r\n          timestamp: new Date().toISOString(),\r\n          level: 'error',\r\n          message: `Process error: ${error.message}`\r\n        })\r\n      })\r\n\r\n      // 添加启动日志\r\n      this.logManager.addLog(project.id, {\r\n        timestamp: new Date().toISOString(),\r\n        level: 'info',\r\n        message: `Starting project: ${command.cmd} ${command.args.join(' ')}`\r\n      })\r\n\r\n      console.log('[ProcessManager] Process started successfully')\r\n      return { success: true, pid: childProcess.pid }\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error'\r\n      console.log('[ProcessManager] Failed to start project:', errorMessage)\r\n      return { success: false, error: errorMessage }\r\n    }\r\n  }\r\n\r\n  async stopProject(projectId: string): Promise<boolean> {\r\n    console.log('[ProcessManager] stopProject called for projectId:', projectId)\r\n    console.log('[ProcessManager] Current running processes:', Array.from(this.runningProcesses.keys()))\r\n    console.log('[ProcessManager] Total running processes count:', this.runningProcesses.size)\r\n    \r\n    const processInfo = this.runningProcesses.get(projectId)\r\n    \r\n    if (!processInfo) {\r\n      console.log('[ProcessManager] No running process found for projectId:', projectId)\r\n      // 如果进程不在运行列表中，可能已经停止了，视为成功\r\n      console.log('[ProcessManager] Process may have already stopped, treating as success')\r\n      return true\r\n    }\r\n\r\n    console.log('[ProcessManager] Found running process, PID:', processInfo.pid)\r\n\r\n    return new Promise((resolve) => {\r\n        let isResolved = false\r\n        let forceKillTimeout: NodeJS.Timeout | null = null\r\n        \r\n        const cleanup = () => {\r\n          if (!isResolved) {\r\n            isResolved = true\r\n            if (forceKillTimeout) {\r\n              clearTimeout(forceKillTimeout)\r\n            }\r\n            this.runningProcesses.delete(projectId)\r\n            console.log('[ProcessManager] Removed process from running processes list')\r\n          }\r\n        }\r\n\r\n      // 监听进程退出事件\r\n      const onExit = (code: number | null, signal: string | null) => {\r\n        console.log(`[ProcessManager] Process ${projectId} exited with code ${code}, signal ${signal}`)\r\n        cleanup()\r\n        \r\n        this.logManager.addLog(projectId, {\r\n          timestamp: new Date().toISOString(),\r\n          level: 'info',\r\n          message: `Project stopped (code: ${code}, signal: ${signal})`\r\n        })\r\n        \r\n        // 通知项目状态变更\r\n        if (this.onProjectStatusChange) {\r\n          console.log(`[ProcessManager] Notifying project status change to stopped for ${projectId}`)\r\n          this.onProjectStatusChange(projectId, 'stopped')\r\n        }\r\n        \r\n        if (!isResolved) {\r\n          resolve(true)\r\n        }\r\n      }\r\n\r\n      // 监听进程错误事件\r\n      const onError = (error: Error) => {\r\n        console.log(`[ProcessManager] Process ${projectId} error during stop:`, error.message)\r\n        \r\n        // 特殊处理WebSocket错误\r\n        if (error.message.includes('WebSocket') || error.message.includes('RSV1')) {\r\n          console.log('[ProcessManager] WebSocket error detected, treating as normal termination')\r\n          this.logManager.addLog(projectId, {\r\n            timestamp: new Date().toISOString(),\r\n            level: 'info',\r\n            message: 'Project stopped (WebSocket connection closed)'\r\n          })\r\n        } else {\r\n          this.logManager.addLog(projectId, {\r\n            timestamp: new Date().toISOString(),\r\n            level: 'warn',\r\n            message: `Process error during stop: ${error.message}`\r\n          })\r\n        }\r\n        \r\n        cleanup()\r\n        if (!isResolved) {\r\n          resolve(true)\r\n        }\r\n      }\r\n\r\n      // 添加事件监听器\r\n      processInfo.process.once('exit', onExit)\r\n      processInfo.process.once('error', onError)\r\n\r\n      try {\r\n        // 记录停止开始\r\n        this.logManager.addLog(projectId, {\r\n          timestamp: new Date().toISOString(),\r\n          level: 'info',\r\n          message: 'Stopping project...'\r\n        })\r\n\r\n        // 第一步：发送SIGTERM信号，给进程时间优雅关闭\r\n        console.log('[ProcessManager] Sending SIGTERM to process for graceful shutdown')\r\n        processInfo.process.kill('SIGTERM')\r\n\r\n        // 设置超时机制：如果5秒内进程没有退出，则强制终止\r\n         forceKillTimeout = setTimeout(() => {\r\n           if (!isResolved) {\r\n             console.log('[ProcessManager] Process did not exit gracefully, sending SIGKILL')\r\n             \r\n             try {\r\n               // 检查进程是否仍然存在\r\n               process.kill(processInfo.pid, 0)\r\n               console.log('[ProcessManager] Process still exists, force killing')\r\n               processInfo.process.kill('SIGKILL')\r\n               \r\n               this.logManager.addLog(projectId, {\r\n                 timestamp: new Date().toISOString(),\r\n                 level: 'warn',\r\n                 message: 'Process force killed after timeout'\r\n               })\r\n             } catch (checkError) {\r\n               // 进程已经不存在了\r\n               console.log('[ProcessManager] Process already terminated during force kill check')\r\n             }\r\n\r\n             // 如果强制杀死后还没有resolve，则手动cleanup和resolve\r\n             setTimeout(() => {\r\n               if (!isResolved) {\r\n                 console.log('[ProcessManager] Force resolving after SIGKILL')\r\n                 cleanup()\r\n                 resolve(true)\r\n               }\r\n             }, 1000)\r\n           }\r\n         }, 5000) // 5秒超时\r\n\r\n        console.log('[ProcessManager] Graceful stop initiated, waiting for process to exit...')\r\n        \r\n      } catch (error) {\r\n        console.error('[ProcessManager] Failed to send stop signal:', error)\r\n        \r\n        this.logManager.addLog(projectId, {\r\n          timestamp: new Date().toISOString(),\r\n          level: 'error',\r\n          message: `Failed to stop project: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n        })\r\n        \r\n        cleanup()\r\n        resolve(false)\r\n      }\r\n    })\r\n  }\r\n\r\n  stopAllProjects(): void {\r\n    for (const [projectId] of this.runningProcesses) {\r\n      this.stopProject(projectId)\r\n    }\r\n  }\r\n\r\n  getRunningProjects(): string[] {\r\n    return Array.from(this.runningProcesses.keys())\r\n  }\r\n\r\n  isProjectRunning(projectId: string): boolean {\r\n    return this.runningProcesses.has(projectId)\r\n  }\r\n\r\n  getProcessInfo(projectId: string): ProcessInfo | undefined {\r\n    return this.runningProcesses.get(projectId)\r\n  }\r\n\r\n  private buildCommand(packageManager: string, startCommand: string): { cmd: string; args: string[] } {\r\n    // 如果启动命令已经包含完整的命令格式，直接解析\r\n    if (startCommand.includes(' ')) {\r\n      const parts = startCommand.trim().split(/\\s+/)\r\n      return { cmd: parts[0], args: parts.slice(1) }\r\n    }\r\n    \r\n    // 向后兼容：如果只是简单的命令名，使用原有的包管理器逻辑\r\n    // 在生产环境中使用完整路径来避免 PATH 问题\r\n    const isProduction = process.env.NODE_ENV === 'production' || !process.env.NODE_ENV\r\n    \r\n    switch (packageManager) {\r\n      case 'pnpm':\r\n        const pnpmCmd = isProduction ? this.getCommandPath('pnpm') : 'pnpm'\r\n        return { cmd: pnpmCmd, args: ['run', startCommand] }\r\n      case 'yarn':\r\n        const yarnCmd = isProduction ? this.getCommandPath('yarn') : 'yarn'\r\n        return { cmd: yarnCmd, args: [startCommand] }\r\n      case 'npm':\r\n      default:\r\n        const npmCmd = isProduction ? this.getCommandPath('npm') : 'npm'\r\n        return { cmd: npmCmd, args: ['run', startCommand] }\r\n    }\r\n  }\r\n\r\n  private getCommandPath(command: string): string {\r\n    const { execSync } = require('child_process')\r\n    const fs = require('fs')\r\n    const path = require('path')\r\n    const os = require('os')\r\n    \r\n    const isWindows = process.platform === 'win32'\r\n    const commandWithExt = isWindows ? `${command}.cmd` : command\r\n    \r\n    try {\r\n      // 在Windows上使用where命令，在Unix系统上使用which命令\r\n      const findCommand = isWindows ? 'where' : 'which'\r\n      const fullPath = execSync(`${findCommand} ${command}`, { encoding: 'utf8' }).trim()\r\n      if (fullPath) {\r\n        // Windows的where命令可能返回多行，取第一行\r\n        const firstPath = fullPath.split('\\n')[0].trim()\r\n        console.log(`[ProcessManager] Found ${command} at: ${firstPath}`)\r\n        // 如果路径包含空格，用引号包围\r\n        return firstPath.includes(' ') ? `\"${firstPath}\"` : firstPath\r\n      }\r\n    } catch (error) {\r\n      console.warn(`[ProcessManager] Could not find ${command} using system command, trying common paths`)\r\n    }\r\n    \r\n    // 如果系统命令失败，尝试常见的路径\r\n    const commonPaths = []\r\n    \r\n    if (isWindows) {\r\n      // Windows常见路径\r\n      const programFiles = process.env['ProgramFiles'] || 'C:\\\\Program Files'\r\n      const programFilesX86 = process.env['ProgramFiles(x86)'] || 'C:\\\\Program Files (x86)'\r\n      const appData = process.env['APPDATA'] || path.join(os.homedir(), 'AppData', 'Roaming')\r\n      const localAppData = process.env['LOCALAPPDATA'] || path.join(os.homedir(), 'AppData', 'Local')\r\n      \r\n      commonPaths.push(\r\n        path.join(programFiles, 'nodejs', `${command}.cmd`),\r\n        path.join(programFilesX86, 'nodejs', `${command}.cmd`),\r\n        path.join(appData, 'npm', `${command}.cmd`),\r\n        path.join(localAppData, 'npm', `${command}.cmd`),\r\n        path.join(os.homedir(), 'AppData', 'Roaming', 'npm', `${command}.cmd`)\r\n      )\r\n      \r\n      // 添加NVM for Windows路径\r\n      const nvmPath = process.env['NVM_HOME']\r\n      if (nvmPath) {\r\n        commonPaths.push(path.join(nvmPath, `${command}.cmd`))\r\n      }\r\n      \r\n      // 添加Volta路径（Windows）\r\n      const voltaHome = process.env['VOLTA_HOME'] || path.join(os.homedir(), '.volta')\r\n      commonPaths.push(path.join(voltaHome, 'bin', `${command}.cmd`))\r\n      \r\n    } else {\r\n      // Unix/Linux/macOS路径\r\n      const homeDir = process.env.HOME || os.homedir()\r\n      commonPaths.push(\r\n        `/usr/local/bin/${command}`,\r\n        `/opt/homebrew/bin/${command}`,\r\n        `/usr/bin/${command}`,\r\n        `${homeDir}/.volta/bin/${command}`\r\n      )\r\n      \r\n      // 添加 NVM 和 FNM 路径（手动遍历目录）\r\n      if (homeDir) {\r\n        try {\r\n          // NVM 路径\r\n          const nvmDir = path.join(homeDir, '.nvm', 'versions', 'node')\r\n          if (fs.existsSync(nvmDir)) {\r\n            const versions = fs.readdirSync(nvmDir)\r\n            for (const version of versions) {\r\n              const binPath = path.join(nvmDir, version, 'bin', command)\r\n              commonPaths.push(binPath)\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.warn('[ProcessManager] Failed to scan NVM paths:', error)\r\n        }\r\n        \r\n        try {\r\n          // FNM 路径\r\n          const fnmDir = path.join(homeDir, '.fnm', 'node-versions')\r\n          if (fs.existsSync(fnmDir)) {\r\n            const versions = fs.readdirSync(fnmDir)\r\n            for (const version of versions) {\r\n              const binPath = path.join(fnmDir, version, 'installation', 'bin', command)\r\n              commonPaths.push(binPath)\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.warn('[ProcessManager] Failed to scan FNM paths:', error)\r\n        }\r\n      }\r\n    }\r\n    \r\n    for (const cmdPath of commonPaths) {\r\n      try {\r\n        if (fs.existsSync(cmdPath)) {\r\n          console.log(`[ProcessManager] Found ${command} at: ${cmdPath}`)\r\n          // 如果路径包含空格，用引号包围\r\n          return cmdPath.includes(' ') ? `\"${cmdPath}\"` : cmdPath\r\n        }\r\n      } catch (error) {\r\n        continue\r\n      }\r\n    }\r\n    \r\n    // 如果都找不到，返回原始命令名，让系统尝试\r\n    console.warn(`[ProcessManager] Could not find full path for ${command}, using original command`)\r\n    return isWindows ? commandWithExt : command\r\n  }\r\n\r\n  private setupLogListeners(projectId: string, childProcess: ChildProcess): void {\r\n    // 监听标准输出\r\n    childProcess.stdout?.on('data', (data) => {\r\n      const message = data.toString().trim()\r\n      if (message) {\r\n        // 检测并提取 URL 信息\r\n        this.extractAndSaveUrl(projectId, message)\r\n        \r\n        this.logManager.addLog(projectId, {\r\n          timestamp: new Date().toISOString(),\r\n          level: 'info',\r\n          message: this.cleanLogMessage(message)\r\n        })\r\n      }\r\n    })\r\n\r\n    // 监听标准错误\r\n    childProcess.stderr?.on('data', (data) => {\r\n      const message = data.toString().trim()\r\n      if (message) {\r\n        // 也检查 stderr 中的 URL 信息（某些工具会将正常信息输出到 stderr）\r\n        this.extractAndSaveUrl(projectId, message)\r\n        \r\n        // 判断是否为错误信息（很多工具会将正常信息输出到 stderr）\r\n        const level = this.isErrorMessage(message) ? 'error' : 'warn'\r\n        this.logManager.addLog(projectId, {\r\n          timestamp: new Date().toISOString(),\r\n          level,\r\n          message: this.cleanLogMessage(message)\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  private extractAndSaveUrl(projectId: string, message: string): void {\r\n    console.log(`[ProcessManager] Checking message for URL patterns: \"${message}\"`)\r\n    \r\n    // 检测常见的开发服务器 URL 模式\r\n    const urlPatterns = [\r\n      // Vite: Local: http://localhost:5173/\r\n      /Local:\\s*https?:\\/\\/[^\\s]+/i,\r\n      // Vue CLI: App running at: - Local: http://localhost:8080/\r\n      /Local:\\s*https?:\\/\\/[^\\s]+/i,\r\n      // Create React App: Local: http://localhost:3000\r\n      /Local:\\s*https?:\\/\\/[^\\s]+/i,\r\n      // Next.js: ready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\n      /url:\\s*https?:\\/\\/[^\\s]+/i,\r\n      // 通用模式: http://localhost:端口\r\n      /https?:\\/\\/localhost:\\d+\\/?/i,\r\n      // 通用模式: http://127.0.0.1:端口\r\n      /https?:\\/\\/127\\.0\\.0\\.1:\\d+\\/?/i\r\n    ]\r\n\r\n    for (const pattern of urlPatterns) {\r\n      const match = message.match(pattern)\r\n      if (match) {\r\n        let url = match[0]\r\n        console.log(`[ProcessManager] Found URL match: \"${url}\" using pattern: ${pattern}`)\r\n        \r\n        // 清理 URL，移除前缀\r\n        url = url.replace(/^(Local:\\s*|url:\\s*)/i, '').trim()\r\n        \r\n        // 确保 URL 以 / 结尾\r\n        if (!url.endsWith('/')) {\r\n          url += '/'\r\n        }\r\n\r\n        // 提取端口号\r\n        const portMatch = url.match(/:(\\d+)/)\r\n        const port = portMatch ? parseInt(portMatch[1]) : undefined\r\n\r\n        console.log(`[ProcessManager] Detected URL for project ${projectId}: ${url}, port: ${port}`)\r\n        \r\n        // 通过 IPC 通知主进程更新项目信息\r\n        if (this.onUrlDetected) {\r\n          console.log(`[ProcessManager] Calling URL detected callback for project ${projectId}`)\r\n          this.onUrlDetected(projectId, url, port)\r\n        } else {\r\n          console.log(`[ProcessManager] No URL detected callback set`)\r\n        }\r\n        \r\n        // 添加 URL 检测日志\r\n        this.logManager.addLog(projectId, {\r\n          timestamp: new Date().toISOString(),\r\n          level: 'info',\r\n          message: `🌐 项目已启动，访问地址: ${url}`\r\n        })\r\n        \r\n        break // 找到第一个匹配的 URL 就停止\r\n      }\r\n    }\r\n    \r\n    if (!message.match(/Local:|url:|localhost|127\\.0\\.0\\.1/i)) {\r\n      // 只有当消息不包含任何URL相关关键词时才跳过日志\r\n    } else {\r\n      console.log(`[ProcessManager] No URL pattern matched for message: \"${message}\"`)\r\n    }\r\n  }\r\n\r\n  // 添加 URL 检测回调\r\n  private onUrlDetected?: (projectId: string, url: string, port?: number) => void\r\n\r\n  setUrlDetectedCallback(callback: (projectId: string, url: string, port?: number) => void): void {\r\n    this.onUrlDetected = callback\r\n  }\r\n\r\n  private cleanLogMessage(message: string): string {\r\n    // 移除 ANSI 颜色代码\r\n    return message.replace(/\\x1b\\[[0-9;]*m/g, '')\r\n  }\r\n\r\n  private isErrorMessage(message: string): boolean {\r\n    const errorKeywords = ['error', 'failed', 'exception', 'cannot', 'unable']\r\n    const lowerMessage = message.toLowerCase()\r\n    return errorKeywords.some(keyword => lowerMessage.includes(keyword))\r\n  }\r\n\r\n  private getEnhancedPath(): string {\r\n    const currentPath = process.env.PATH || ''\r\n    const fs = require('fs')\r\n    const path = require('path')\r\n    const os = require('os')\r\n    \r\n    const isWindows = process.platform === 'win32'\r\n    const pathSeparator = isWindows ? ';' : ':'\r\n    \r\n    // 获取系统中所有可能的 Node.js 和包管理器路径\r\n    const additionalPaths = []\r\n    \r\n    if (isWindows) {\r\n      // Windows路径\r\n      const programFiles = process.env['ProgramFiles'] || 'C:\\\\Program Files'\r\n      const programFilesX86 = process.env['ProgramFiles(x86)'] || 'C:\\\\Program Files (x86)'\r\n      const appData = process.env['APPDATA'] || path.join(os.homedir(), 'AppData', 'Roaming')\r\n      const localAppData = process.env['LOCALAPPDATA'] || path.join(os.homedir(), 'AppData', 'Local')\r\n      \r\n      additionalPaths.push(\r\n        path.join(programFiles, 'nodejs'),\r\n        path.join(programFilesX86, 'nodejs'),\r\n        path.join(appData, 'npm'),\r\n        path.join(localAppData, 'npm'),\r\n        path.join(os.homedir(), 'AppData', 'Roaming', 'npm')\r\n      )\r\n      \r\n      // 添加NVM for Windows路径\r\n      const nvmPath = process.env['NVM_HOME']\r\n      if (nvmPath) {\r\n        additionalPaths.push(nvmPath)\r\n      }\r\n      \r\n      // 添加Volta路径（Windows）\r\n      const voltaHome = process.env['VOLTA_HOME'] || path.join(os.homedir(), '.volta')\r\n      additionalPaths.push(path.join(voltaHome, 'bin'))\r\n      \r\n    } else {\r\n      // Unix/Linux/macOS路径\r\n      additionalPaths.push(\r\n        '/usr/local/bin',\r\n        '/opt/homebrew/bin',\r\n        '/usr/bin',\r\n        '/bin'\r\n      )\r\n      \r\n      // 添加 Node.js 版本管理器的路径\r\n      const homeDir = process.env.HOME || os.homedir()\r\n      if (homeDir) {\r\n        // NVM 路径\r\n        try {\r\n          const nvmDir = path.join(homeDir, '.nvm', 'versions', 'node')\r\n          if (fs.existsSync(nvmDir)) {\r\n            const versions = fs.readdirSync(nvmDir)\r\n            for (const version of versions) {\r\n              const binPath = path.join(nvmDir, version, 'bin')\r\n              if (fs.existsSync(binPath)) {\r\n                additionalPaths.push(binPath)\r\n              }\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.warn('[ProcessManager] Failed to resolve NVM paths:', error)\r\n        }\r\n        \r\n        // Volta 路径\r\n        additionalPaths.push(`${homeDir}/.volta/bin`)\r\n        \r\n        // FNM 路径\r\n        try {\r\n          const fnmDir = path.join(homeDir, '.fnm', 'node-versions')\r\n          if (fs.existsSync(fnmDir)) {\r\n            const versions = fs.readdirSync(fnmDir)\r\n            for (const version of versions) {\r\n              const binPath = path.join(fnmDir, version, 'installation', 'bin')\r\n              if (fs.existsSync(binPath)) {\r\n                additionalPaths.push(binPath)\r\n              }\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.warn('[ProcessManager] Failed to resolve FNM paths:', error)\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 去重并过滤存在的路径\r\n    const uniquePaths = [...new Set([...currentPath.split(pathSeparator), ...additionalPaths])]\r\n      .filter(pathStr => {\r\n        if (!pathStr) return false\r\n        try {\r\n          return fs.existsSync(pathStr)\r\n        } catch {\r\n          return false\r\n        }\r\n      })\r\n    \r\n    const enhancedPath = uniquePaths.join(pathSeparator)\r\n    console.log(`[ProcessManager] Enhanced PATH: ${enhancedPath}`)\r\n    return enhancedPath\r\n  }\r\n}","import { BrowserWindow } from 'electron'\r\n\r\nexport interface LogEntry {\r\n  timestamp: string\r\n  level: 'info' | 'warn' | 'error'\r\n  message: string\r\n}\r\n\r\nexport class LogManager {\r\n  private logs: Map<string, LogEntry[]> = new Map()\r\n  private maxLogsPerProject = 500\r\n  private mainWindow?: BrowserWindow\r\n\r\n  setMainWindow(window: BrowserWindow): void {\r\n    this.mainWindow = window\r\n  }\r\n\r\n  addLog(projectId: string, logEntry: LogEntry): void {\r\n    if (!this.logs.has(projectId)) {\r\n      this.logs.set(projectId, [])\r\n    }\r\n\r\n    const projectLogs = this.logs.get(projectId)!\r\n    projectLogs.push(logEntry)\r\n\r\n    // 保持循环缓冲区大小\r\n    if (projectLogs.length > this.maxLogsPerProject) {\r\n      projectLogs.shift() // 移除最旧的日志\r\n    }\r\n\r\n    // 实时发送日志到渲染进程\r\n    this.sendLogToRenderer(projectId, logEntry)\r\n  }\r\n\r\n  getMemoryLogs(projectId: string): LogEntry[] {\r\n    return this.logs.get(projectId) || []\r\n  }\r\n\r\n  getAllMemoryLogs(): Record<string, LogEntry[]> {\r\n    const result: Record<string, LogEntry[]> = {}\r\n    for (const [projectId, logs] of this.logs) {\r\n      result[projectId] = [...logs]\r\n    }\r\n    return result\r\n  }\r\n\r\n  clearProjectLogs(projectId: string): void {\r\n    this.logs.delete(projectId)\r\n    \r\n    // 通知渲染进程日志已清除\r\n    if (this.mainWindow && !this.mainWindow.isDestroyed()) {\r\n      this.mainWindow.webContents.send('logs:cleared', projectId)\r\n    }\r\n  }\r\n\r\n  clearAllLogs(): void {\r\n    this.logs.clear()\r\n    \r\n    // 通知渲染进程所有日志已清除\r\n    if (this.mainWindow && !this.mainWindow.isDestroyed()) {\r\n      this.mainWindow.webContents.send('logs:allCleared')\r\n    }\r\n  }\r\n\r\n  getLogStats(projectId: string): { total: number; errors: number; warnings: number } {\r\n    const logs = this.logs.get(projectId) || []\r\n    \r\n    return {\r\n      total: logs.length,\r\n      errors: logs.filter(log => log.level === 'error').length,\r\n      warnings: logs.filter(log => log.level === 'warn').length\r\n    }\r\n  }\r\n\r\n  // 获取最近的错误日志\r\n  getRecentErrors(projectId: string, limit = 10): LogEntry[] {\r\n    const logs = this.logs.get(projectId) || []\r\n    return logs\r\n      .filter(log => log.level === 'error')\r\n      .slice(-limit)\r\n  }\r\n\r\n  // 搜索日志\r\n  searchLogs(projectId: string, query: string, level?: LogEntry['level']): LogEntry[] {\r\n    const logs = this.logs.get(projectId) || []\r\n    const lowerQuery = query.toLowerCase()\r\n    \r\n    return logs.filter(log => {\r\n      const matchesQuery = log.message.toLowerCase().includes(lowerQuery)\r\n      const matchesLevel = !level || log.level === level\r\n      return matchesQuery && matchesLevel\r\n    })\r\n  }\r\n\r\n  private sendLogToRenderer(projectId: string, logEntry: LogEntry): void {\r\n    if (this.mainWindow && !this.mainWindow.isDestroyed()) {\r\n      this.mainWindow.webContents.send('logs:newEntry', {\r\n        projectId,\r\n        logEntry\r\n      })\r\n    }\r\n  }\r\n\r\n  // 获取内存使用情况\r\n  getMemoryUsage(): { totalProjects: number; totalLogs: number; estimatedMemoryKB: number } {\r\n    let totalLogs = 0\r\n    let estimatedMemoryBytes = 0\r\n\r\n    for (const [projectId, logs] of this.logs) {\r\n      totalLogs += logs.length\r\n      \r\n      // 估算内存使用（粗略计算）\r\n      for (const log of logs) {\r\n        estimatedMemoryBytes += JSON.stringify(log).length * 2 // UTF-16 字符\r\n      }\r\n      estimatedMemoryBytes += projectId.length * 2\r\n    }\r\n\r\n    return {\r\n      totalProjects: this.logs.size,\r\n      totalLogs,\r\n      estimatedMemoryKB: Math.round(estimatedMemoryBytes / 1024)\r\n    }\r\n  }\r\n\r\n  // 清理过期项目的日志（当项目被删除时调用）\r\n  cleanupProjectLogs(projectId: string): void {\r\n    this.logs.delete(projectId)\r\n  }\r\n}","import { readFileSync, writeFileSync, existsSync } from 'fs'\r\nimport { join } from 'path'\r\nimport { app } from 'electron'\r\n\r\nexport interface AppConfig {\r\n  theme: 'light' | 'dark' | 'system'\r\n  autoStart: boolean\r\n  minimizeToTray: boolean\r\n  showNotifications: boolean\r\n  defaultPackageManager: 'npm' | 'pnpm' | 'yarn'\r\n  maxConcurrentProjects: number\r\n  windowBounds?: {\r\n    x: number\r\n    y: number\r\n    width: number\r\n    height: number\r\n  }\r\n  language: 'zh-CN' | 'en-US'\r\n  logLevel: 'info' | 'warn' | 'error'\r\n}\r\n\r\nconst DEFAULT_CONFIG: AppConfig = {\r\n  theme: 'system',\r\n  autoStart: false,\r\n  minimizeToTray: true,\r\n  showNotifications: true,\r\n  defaultPackageManager: 'npm',\r\n  maxConcurrentProjects: 5,\r\n  language: 'en-US',\r\n  logLevel: 'info'\r\n}\r\n\r\nexport class ConfigManager {\r\n  private configFilePath: string\r\n  private config: AppConfig\r\n\r\n  constructor() {\r\n    this.configFilePath = join(app.getPath('userData'), 'app-config.json')\r\n    this.config = this.loadConfig()\r\n  }\r\n\r\n  private loadConfig(): AppConfig {\r\n    try {\r\n      if (existsSync(this.configFilePath)) {\r\n        const data = readFileSync(this.configFilePath, 'utf-8')\r\n        const savedConfig = JSON.parse(data)\r\n        \r\n        // 合并默认配置和保存的配置，确保新增的配置项有默认值\r\n        return { ...DEFAULT_CONFIG, ...savedConfig }\r\n      } else {\r\n        this.saveConfig(DEFAULT_CONFIG)\r\n        return { ...DEFAULT_CONFIG }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load config:', error)\r\n      return { ...DEFAULT_CONFIG }\r\n    }\r\n  }\r\n\r\n  private saveConfig(config: AppConfig): void {\r\n    try {\r\n      writeFileSync(this.configFilePath, JSON.stringify(config, null, 2))\r\n    } catch (error) {\r\n      console.error('Failed to save config:', error)\r\n    }\r\n  }\r\n\r\n  getConfig(): AppConfig {\r\n    return { ...this.config }\r\n  }\r\n\r\n  updateConfig(updates: Partial<AppConfig>): AppConfig {\r\n    this.config = { ...this.config, ...updates }\r\n    this.saveConfig(this.config)\r\n    return { ...this.config }\r\n  }\r\n\r\n  resetConfig(): AppConfig {\r\n    this.config = { ...DEFAULT_CONFIG }\r\n    this.saveConfig(this.config)\r\n    return { ...this.config }\r\n  }\r\n\r\n  // 获取特定配置项\r\n  getTheme(): AppConfig['theme'] {\r\n    return this.config.theme\r\n  }\r\n\r\n  getDefaultPackageManager(): AppConfig['defaultPackageManager'] {\r\n    return this.config.defaultPackageManager\r\n  }\r\n\r\n  getMaxConcurrentProjects(): number {\r\n    return this.config.maxConcurrentProjects\r\n  }\r\n\r\n  getLanguage(): AppConfig['language'] {\r\n    return this.config.language\r\n  }\r\n\r\n  // 设置特定配置项\r\n  setTheme(theme: AppConfig['theme']): void {\r\n    this.updateConfig({ theme })\r\n  }\r\n\r\n  setDefaultPackageManager(packageManager: AppConfig['defaultPackageManager']): void {\r\n    this.updateConfig({ defaultPackageManager: packageManager })\r\n  }\r\n\r\n  setWindowBounds(bounds: AppConfig['windowBounds']): void {\r\n    this.updateConfig({ windowBounds: bounds })\r\n  }\r\n\r\n  setLanguage(language: AppConfig['language']): void {\r\n    this.updateConfig({ language })\r\n  }\r\n\r\n  // 验证配置\r\n  validateConfig(config: Partial<AppConfig>): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = []\r\n\r\n    if (config.theme && !['light', 'dark', 'system'].includes(config.theme)) {\r\n      errors.push('Invalid theme value')\r\n    }\r\n\r\n    if (config.defaultPackageManager && !['npm', 'pnpm', 'yarn'].includes(config.defaultPackageManager)) {\r\n      errors.push('Invalid package manager')\r\n    }\r\n\r\n    if (config.maxConcurrentProjects && (config.maxConcurrentProjects < 1 || config.maxConcurrentProjects > 20)) {\r\n      errors.push('Max concurrent projects must be between 1 and 20')\r\n    }\r\n\r\n    if (config.language && !['zh-CN', 'en-US'].includes(config.language)) {\r\n      errors.push('Invalid language')\r\n    }\r\n\r\n    if (config.logLevel && !['info', 'warn', 'error'].includes(config.logLevel)) {\r\n      errors.push('Invalid log level')\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors\r\n    }\r\n  }\r\n\r\n  // 导出配置\r\n  exportConfig(): string {\r\n    return JSON.stringify(this.config, null, 2)\r\n  }\r\n\r\n  // 导入配置\r\n  importConfig(configJson: string): { success: boolean; error?: string } {\r\n    try {\r\n      const importedConfig = JSON.parse(configJson)\r\n      const validation = this.validateConfig(importedConfig)\r\n      \r\n      if (!validation.valid) {\r\n        return {\r\n          success: false,\r\n          error: `Invalid configuration: ${validation.errors.join(', ')}`\r\n        }\r\n      }\r\n\r\n      this.config = { ...DEFAULT_CONFIG, ...importedConfig }\r\n      this.saveConfig(this.config)\r\n      \r\n      return { success: true }\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Invalid JSON format'\r\n      }\r\n    }\r\n  }\r\n}","import { app, BrowserWindow, ipcMain, dialog, shell } from 'electron'\r\nimport { join } from 'path'\r\nimport { ProjectManager } from './services/ProjectManager'\r\nimport { ProcessManager } from './services/ProcessManager'\r\nimport { LogManager } from './services/LogManager'\r\nimport { ConfigManager } from './services/ConfigManager'\r\n\r\n// 服务实例\r\nlet projectManager: ProjectManager\r\nlet processManager: ProcessManager\r\nlet logManager: LogManager\r\nlet configManager: ConfigManager\r\n\r\n// 主窗口\r\nlet mainWindow: BrowserWindow | null = null\r\n\r\nconst isDev = process.env.NODE_ENV === 'development'\r\n\r\nfunction createWindow() {\r\n  // 获取窗口配置\r\n  const config = configManager ? configManager.getConfig() : null\r\n  \r\n  mainWindow = new BrowserWindow({\r\n    width: config?.windowBounds?.width || 1200,\r\n    height: config?.windowBounds?.height || 800,\r\n    x: config?.windowBounds?.x,\r\n    y: config?.windowBounds?.y,\r\n    minWidth: 800,\r\n    minHeight: 600,\r\n    webPreferences: {\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n      preload: join(__dirname, 'preload.js')\r\n    },\r\n    titleBarStyle: 'hiddenInset',\r\n    show: false\r\n  })\r\n\r\n  // 加载应用\r\n  if (isDev) {\r\n    mainWindow.loadURL('http://localhost:5173')\r\n    mainWindow.webContents.openDevTools()\r\n  } else {\r\n    mainWindow.loadFile(join(__dirname, '../dist/index.html'))\r\n  }\r\n\r\n  // 窗口准备好后显示\r\n  mainWindow.once('ready-to-show', () => {\r\n    mainWindow?.show()\r\n  })\r\n\r\n  // 保存窗口位置和大小\r\n  mainWindow.on('close', () => {\r\n    if (mainWindow && configManager) {\r\n      const bounds = mainWindow.getBounds()\r\n      configManager.updateConfig({\r\n        windowBounds: bounds\r\n      })\r\n    }\r\n  })\r\n\r\n  mainWindow.on('closed', () => {\r\n    mainWindow = null\r\n  })\r\n}\r\n\r\n// 初始化服务\r\nfunction initializeServices() {\r\n  configManager = new ConfigManager()\r\n  projectManager = new ProjectManager()\r\n  logManager = new LogManager()\r\n  processManager = new ProcessManager(logManager)\r\n  \r\n  // 设置 URL 检测回调\r\n  processManager.setUrlDetectedCallback((projectId: string, url: string, port?: number) => {\r\n    console.log(`[Main] URL detected for project ${projectId}: ${url}`)\r\n    projectManager.updateProject(projectId, { \r\n      url: url,\r\n      port: port \r\n    })\r\n  })\r\n  \r\n  // 设置项目状态变更回调\r\n  processManager.setProjectStatusChangeCallback((projectId: string, status: 'running' | 'stopped') => {\r\n    console.log(`[Main] Project status change for ${projectId}: ${status}`)\r\n    if (status === 'stopped') {\r\n      projectManager.updateProject(projectId, { \r\n        status: 'stopped',\r\n        pid: undefined,\r\n        url: undefined,\r\n        port: undefined\r\n      })\r\n    }\r\n  })\r\n  \r\n  // 应用启动时重置所有项目状态为停止状态\r\n  // 因为应用重启后，之前运行的进程已经不在ProcessManager的管理范围内\r\n  projectManager.resetAllProjectsToStopped()\r\n}\r\n\r\n// 设置 IPC 处理器\r\nfunction setupIpcHandlers() {\r\n  // 项目管理\r\n  ipcMain.handle('projects:getAll', () => projectManager.getAllProjects())\r\n  ipcMain.handle('projects:create', (_, projectData) => projectManager.createProject(projectData))\r\n  ipcMain.handle('projects:update', (_, id, updates) => projectManager.updateProject(id, updates))\r\n  ipcMain.handle('projects:delete', (_, id) => projectManager.deleteProject(id))\r\n  ipcMain.handle('projects:getRunning', () => processManager.getRunningProjects())\r\n\r\n  // 项目控制\r\n  ipcMain.handle('projects:start', async (_, id) => {\r\n    const project = projectManager.getProject(id)\r\n    if (!project) return { success: false, error: 'Project not found' }\r\n    \r\n    const result = await processManager.startProject(project)\r\n    if (result.success) {\r\n      projectManager.updateProject(id, { \r\n        status: 'running', \r\n        pid: result.pid \r\n      })\r\n    }\r\n    return result\r\n  })\r\n\r\n  ipcMain.handle('projects:stop', async (_, id) => {\r\n    console.log('[IPC] projects:stop called for id:', id)\r\n    const success = await processManager.stopProject(id)\r\n    console.log('[IPC] processManager.stopProject result:', success)\r\n    \r\n    if (success) {\r\n      console.log('[IPC] Updating project status to stopped')\r\n      projectManager.updateProject(id, { \r\n        status: 'stopped', \r\n        pid: undefined \r\n      })\r\n      console.log('[IPC] Project status updated successfully')\r\n    } else {\r\n      console.log('[IPC] Failed to stop project, not updating status')\r\n    }\r\n    \r\n    console.log('[IPC] Returning success:', success)\r\n    return success\r\n  })\r\n\r\n  ipcMain.handle('projects:getStatus', (_, id) => {\r\n    const project = projectManager.getProject(id)\r\n    return project ? project.status : 'stopped'\r\n  })\r\n\r\n  // 日志管理\r\n  ipcMain.handle('logs:getMemoryLogs', (_, projectId) => logManager.getMemoryLogs(projectId))\r\n  ipcMain.handle('logs:clearAll', () => logManager.clearAllLogs())\r\n  ipcMain.handle('logs:clear', (_, projectId) => logManager.clearProjectLogs(projectId))\r\n\r\n  // 配置管理\r\n  ipcMain.handle('config:get', () => configManager.getConfig())\r\n  ipcMain.handle('config:update', (_, updates) => configManager.updateConfig(updates))\r\n  ipcMain.handle('config:reset', () => configManager.resetConfig())\r\n\r\n  // 文件对话框\r\n  ipcMain.handle('dialog:selectFolder', async () => {\r\n    if (!mainWindow) return null\r\n    \r\n    const result = await dialog.showOpenDialog(mainWindow, {\r\n      properties: ['openDirectory'],\r\n      title: '选择项目文件夹'\r\n    })\r\n    \r\n    return result.canceled ? null : result.filePaths[0]\r\n  })\r\n\r\n  // 打开文件夹\r\n  ipcMain.handle('system:openFolder', async (_, folderPath) => {\r\n    try {\r\n      await shell.openPath(folderPath)\r\n      return { success: true }\r\n    } catch (error) {\r\n      console.error('Failed to open folder:', error)\r\n      return { success: false, error: error instanceof Error ? error.message : String(error) }\r\n    }\r\n  })\r\n}\r\n\r\n// 应用事件\r\napp.whenReady().then(() => {\r\n  initializeServices()\r\n  setupIpcHandlers()\r\n  createWindow()\r\n\r\n  // 在窗口创建后设置日志管理器的主窗口引用\r\n  if (mainWindow && logManager) {\r\n    logManager.setMainWindow(mainWindow)\r\n  }\r\n\r\n  app.on('activate', () => {\r\n    if (BrowserWindow.getAllWindows().length === 0) {\r\n      createWindow()\r\n    }\r\n  })\r\n})\r\n\r\napp.on('window-all-closed', () => {\r\n  // 停止所有运行中的项目\r\n  if (processManager) {\r\n    processManager.stopAllProjects()\r\n  }\r\n  \r\n  if (process.platform !== 'darwin') {\r\n    app.quit()\r\n  }\r\n})\r\n\r\napp.on('before-quit', () => {\r\n  // 清理资源\r\n  if (processManager) {\r\n    processManager.stopAllProjects()\r\n  }\r\n})"],"names":["join","app","existsSync","readFileSync","writeFileSync","randomUUID","logManager","spawn","fs","path","BrowserWindow","ipcMain","dialog","shell"],"mappings":";;;;;;;;;;;;AA+BO,MAAM,eAAe;AAAA,EAI1B,cAAc;AAHN;AACA,oCAAsB,CAAA;AAG5B,SAAK,mBAAmBA,UAAKC,SAAAA,IAAI,QAAQ,UAAU,GAAG,eAAe;AACrE,SAAK,aAAa;AAAA,EACpB;AAAA,EAEQ,eAAqB;AACvB,QAAA;AACE,UAAAC,GAAA,WAAW,KAAK,gBAAgB,GAAG;AACrC,cAAM,OAAOC,GAAA,aAAa,KAAK,kBAAkB,OAAO;AAClD,cAAA,eAA6B,KAAK,MAAM,IAAI;AAC7C,aAAA,WAAW,aAAa,YAAY,CAAA;AAAA,MAAC,OACrC;AACL,aAAK,WAAW;AAChB,aAAK,aAAa;AAAA,MACpB;AAAA,aACO,OAAO;AACN,cAAA,MAAM,4BAA4B,KAAK;AAC/C,WAAK,WAAW;IAClB;AAAA,EACF;AAAA,EAEQ,eAAqB;AAC3B,YAAQ,IAAI,2DAA2D,KAAK,SAAS,MAAM;AACnF,YAAA,IAAI,mCAAmC,KAAK,QAAQ;AACpD,YAAA,IAAI,oCAAoC,KAAK,gBAAgB;AACjE,QAAA;AACF,YAAM,OAAqB,EAAE,UAAU,KAAK,SAAS;AACrDC,uBAAc,KAAK,kBAAkB,KAAK,UAAU,MAAM,MAAM,CAAC,CAAC;AAClE,cAAQ,IAAI,sDAAsD;AAAA,aAC3D,OAAO;AACN,cAAA,MAAM,6CAA6C,KAAK;AAAA,IAClE;AAAA,EACF;AAAA,EAEA,iBAA4B;AAC1B,YAAQ,IAAI,sDAAsD,KAAK,SAAS,QAAQ,UAAU;AAC3F,WAAA,CAAC,GAAG,KAAK,QAAQ;AAAA,EAC1B;AAAA,EAEA,WAAW,IAAiC;AAC1C,WAAO,KAAK,SAAS,KAAK,CAAW,YAAA,QAAQ,OAAO,EAAE;AAAA,EACxD;AAAA,EAEA,cAAc,aAAyC;AAC7C,YAAA,IAAI,oDAAoD,WAAW;AAC3E,UAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AAGnC,QAAI,eAAe,YAAY;AAG/B,QAAI,CAAC,cAAc;AACF,qBAAA;AAGX,UAAA;AACF,cAAM,kBAAkBJ,KAAA,KAAK,YAAY,MAAM,cAAc;AACrD,gBAAA,IAAI,8CAA8C,eAAe;AACrE,YAAAE,GAAAA,WAAW,eAAe,GAAG;AAC/B,gBAAM,cAAc,KAAK,MAAMC,GAAa,aAAA,iBAAiB,OAAO,CAAC;AAC/D,gBAAA,UAAU,YAAY,WAAW;AAC/B,kBAAA,IAAI,mCAAmC,OAAO;AAGtD,cAAI,QAAQ,KAAK;AACA,2BAAA;AAAA,UAAA,WACN,QAAQ,OAAO;AACT,2BAAA;AAAA,UAAA,WACN,QAAQ,OAAO;AACT,2BAAA;AAAA,UACjB;AAAA,QAAA,OACK;AACL,kBAAQ,IAAI,iDAAiD;AAAA,QAC/D;AAAA,eACO,OAAO;AACN,gBAAA,KAAK,iDAAiD,KAAK;AAAA,MACrE;AAAA,IAAA,OACK;AACG,cAAA,IAAI,sDAAsD,YAAY;AAAA,IAChF;AAEA,UAAM,UAAmB;AAAA,MACvB,IAAIE,OAAAA,WAAW;AAAA,MACf,MAAM,YAAY;AAAA,MAClB,MAAM,YAAY;AAAA,MAClB,gBAAgB,YAAY;AAAA,MAC5B;AAAA,MACA,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,WAAW;AAAA,IAAA;AAGL,YAAA,IAAI,4CAA4C,OAAO;AAC/D,YAAQ,IAAI,uDAAuD,KAAK,SAAS,MAAM;AAElF,SAAA,SAAS,KAAK,OAAO;AAC1B,YAAQ,IAAI,sDAAsD,KAAK,SAAS,MAAM;AAEtF,YAAQ,IAAI,0CAA0C;AACtD,SAAK,aAAa;AAClB,YAAQ,IAAI,yCAAyC;AAE9C,WAAA;AAAA,EACT;AAAA,EAEA,cAAc,IAAY,SAA2C;AACnE,UAAM,eAAe,KAAK,SAAS,UAAU,CAAW,YAAA,QAAQ,OAAO,EAAE;AACzE,QAAI,iBAAiB;AAAW,aAAA;AAE3B,SAAA,SAAS,YAAY,IAAI;AAAA,MAC5B,GAAG,KAAK,SAAS,YAAY;AAAA,MAC7B,GAAG;AAAA,MACH,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IAAA;AAGpC,SAAK,aAAa;AACX,WAAA,KAAK,SAAS,YAAY;AAAA,EACnC;AAAA;AAAA,EAGA,4BAAkC;AAChC,YAAQ,IAAI,2DAA2D;AACvE,QAAI,aAAa;AAEZ,SAAA,SAAS,QAAQ,CAAW,YAAA;AAC/B,UAAI,QAAQ,WAAW,aAAa,QAAQ,OAAO,QAAQ,KAAK;AAC9D,gBAAQ,IAAI,uCAAuC,QAAQ,IAAI,QAAQ,IAAI;AAC3E,gBAAQ,SAAS;AACjB,gBAAQ,MAAM;AACd,gBAAQ,MAAM;AACd,gBAAQ,OAAO;AACf,gBAAQ,aAAY,oBAAI,KAAK,GAAE,YAAY;AAC9B,qBAAA;AAAA,MACf;AAAA,IAAA,CACD;AAED,QAAI,YAAY;AACd,cAAQ,IAAI,gDAAgD;AAC5D,WAAK,aAAa;AAAA,IAAA,OACb;AACL,cAAQ,IAAI,kDAAkD;AAAA,IAChE;AAAA,EACF;AAAA,EAEA,cAAc,IAAqB;AACjC,UAAM,eAAe,KAAK,SAAS,UAAU,CAAW,YAAA,QAAQ,OAAO,EAAE;AAEzE,QAAI,iBAAiB,IAAI;AAChB,aAAA;AAAA,IACT;AAEK,SAAA,SAAS,OAAO,cAAc,CAAC;AACpC,SAAK,aAAa;AAEX,WAAA;AAAA,EACT;AAAA;AAAA,EAGA,qBAAqB,aAA8C;AACjE,QAAIH,GAAW,WAAAF,KAAA,KAAK,aAAa,gBAAgB,CAAC,GAAG;AAC5C,aAAA;AAAA,IACT;AACA,QAAIE,GAAW,WAAAF,KAAA,KAAK,aAAa,WAAW,CAAC,GAAG;AACvC,aAAA;AAAA,IACT;AACO,WAAA;AAAA,EACT;AAAA;AAAA,EAGA,oBAAoB,aAA8B;AAChD,WAAOE,GAAW,WAAAF,KAAA,KAAK,aAAa,cAAc,CAAC;AAAA,EACrD;AACF;ACpMO,MAAM,eAAe;AAAA,EAK1B,YAAYM,aAAwB;AAJ5B,gEAAiD;AACjD;AACA;AAkfA;AAAA;AA/eN,SAAK,aAAaA;AAAA,EACpB;AAAA,EAEA,+BAA+B,UAA4E;AACzG,SAAK,wBAAwB;AAAA,EAC/B;AAAA,EAEA,MAAM,aAAa,SAA+E;AAChG,YAAQ,IAAI,qDAAqD,QAAQ,IAAI,QAAQ,IAAI;AAErF,QAAA;AAEF,UAAI,KAAK,iBAAiB,IAAI,QAAQ,EAAE,GAAG;AACzC,gBAAQ,IAAI,6CAA6C;AACzD,eAAO,EAAE,SAAS,OAAO,OAAO,6BAA6B;AAAA,MAC/D;AAGA,YAAM,UAAU,KAAK,aAAa,QAAQ,gBAAgB,QAAQ,YAAY;AACtE,cAAA,IAAI,sCAAsC,QAAQ,KAAK,QAAQ,KAAK,KAAK,GAAG,CAAC;AAC7E,cAAA,IAAI,uCAAuC,QAAQ,IAAI;AAC/D,cAAQ,IAAI,0CAA0C,QAAQ,IAAI,YAAY,WAAW;AAGzF,YAAM,eAAeC,cAAAA,MAAM,QAAQ,KAAK,QAAQ,MAAM;AAAA,QACpD,KAAK,QAAQ;AAAA,QACb,OAAO,CAAC,QAAQ,QAAQ,MAAM;AAAA,QAC9B,OAAO;AAAA,QACP,KAAK;AAAA,UACH,GAAG,QAAQ;AAAA,UACX,aAAa;AAAA;AAAA,UAEb,MAAM,KAAK,gBAAgB;AAAA,QAC7B;AAAA,MAAA,CACD;AAEG,UAAA,CAAC,aAAa,KAAK;AACrB,gBAAQ,IAAI,uDAAuD;AACnE,eAAO,EAAE,SAAS,OAAO,OAAO,0BAA0B;AAAA,MAC5D;AAEQ,cAAA,IAAI,8CAA8C,aAAa,GAAG;AAG1E,YAAM,cAA2B;AAAA,QAC/B,WAAW,QAAQ;AAAA,QACnB,SAAS;AAAA,QACT,KAAK,aAAa;AAAA,QAClB,+BAAe,KAAK;AAAA,MAAA;AAGtB,WAAK,iBAAiB,IAAI,QAAQ,IAAI,WAAW;AACjD,cAAQ,IAAI,0DAA0D;AAC9D,cAAA,IAAI,+CAA+C,MAAM,KAAK,KAAK,iBAAiB,KAAM,CAAA,CAAC;AAG9F,WAAA,kBAAkB,QAAQ,IAAI,YAAY;AAG/C,mBAAa,GAAG,QAAQ,CAAC,MAAM,WAAW;AACxC,gBAAQ,IAAI,oCAAoC,QAAQ,IAAI,SAAS,MAAM,WAAW,MAAM;AACvF,aAAA,iBAAiB,OAAO,QAAQ,EAAE;AACvC,gBAAQ,IAAI,4DAA4D;AACnE,aAAA,WAAW,OAAO,QAAQ,IAAI;AAAA,UACjC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO,SAAS,IAAI,SAAS;AAAA,UAC7B,SAAS,4BAA4B,IAAI,IAAI,SAAS,IAAI,MAAM,MAAM,EAAE;AAAA,QAAA,CACzE;AAAA,MAAA,CACF;AAEY,mBAAA,GAAG,SAAS,CAAC,UAAU;AAClC,gBAAQ,IAAI,mCAAmC,QAAQ,IAAI,MAAM,OAAO;AACnE,aAAA,iBAAiB,OAAO,QAAQ,EAAE;AACvC,gBAAQ,IAAI,6DAA6D;AACpE,aAAA,WAAW,OAAO,QAAQ,IAAI;AAAA,UACjC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO;AAAA,UACP,SAAS,kBAAkB,MAAM,OAAO;AAAA,QAAA,CACzC;AAAA,MAAA,CACF;AAGI,WAAA,WAAW,OAAO,QAAQ,IAAI;AAAA,QACjC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,OAAO;AAAA,QACP,SAAS,qBAAqB,QAAQ,GAAG,IAAI,QAAQ,KAAK,KAAK,GAAG,CAAC;AAAA,MAAA,CACpE;AAED,cAAQ,IAAI,+CAA+C;AAC3D,aAAO,EAAE,SAAS,MAAM,KAAK,aAAa,IAAI;AAAA,aACvC,OAAO;AACd,YAAM,eAAe,iBAAiB,QAAQ,MAAM,UAAU;AACtD,cAAA,IAAI,6CAA6C,YAAY;AACrE,aAAO,EAAE,SAAS,OAAO,OAAO,aAAa;AAAA,IAC/C;AAAA,EACF;AAAA,EAEA,MAAM,YAAY,WAAqC;AAC7C,YAAA,IAAI,sDAAsD,SAAS;AACnE,YAAA,IAAI,+CAA+C,MAAM,KAAK,KAAK,iBAAiB,KAAM,CAAA,CAAC;AACnG,YAAQ,IAAI,mDAAmD,KAAK,iBAAiB,IAAI;AAEzF,UAAM,cAAc,KAAK,iBAAiB,IAAI,SAAS;AAEvD,QAAI,CAAC,aAAa;AACR,cAAA,IAAI,4DAA4D,SAAS;AAEjF,cAAQ,IAAI,wEAAwE;AAC7E,aAAA;AAAA,IACT;AAEQ,YAAA,IAAI,gDAAgD,YAAY,GAAG;AAEpE,WAAA,IAAI,QAAQ,CAAC,YAAY;AAC5B,UAAI,aAAa;AACjB,UAAI,mBAA0C;AAE9C,YAAM,UAAU,MAAM;AACpB,YAAI,CAAC,YAAY;AACF,uBAAA;AACb,cAAI,kBAAkB;AACpB,yBAAa,gBAAgB;AAAA,UAC/B;AACK,eAAA,iBAAiB,OAAO,SAAS;AACtC,kBAAQ,IAAI,8DAA8D;AAAA,QAC5E;AAAA,MAAA;AAIE,YAAA,SAAS,CAAC,MAAqB,WAA0B;AAC7D,gBAAQ,IAAI,4BAA4B,SAAS,qBAAqB,IAAI,YAAY,MAAM,EAAE;AACtF;AAEH,aAAA,WAAW,OAAO,WAAW;AAAA,UAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO;AAAA,UACP,SAAS,0BAA0B,IAAI,aAAa,MAAM;AAAA,QAAA,CAC3D;AAGD,YAAI,KAAK,uBAAuB;AACtB,kBAAA,IAAI,mEAAmE,SAAS,EAAE;AACrF,eAAA,sBAAsB,WAAW,SAAS;AAAA,QACjD;AAEA,YAAI,CAAC,YAAY;AACf,kBAAQ,IAAI;AAAA,QACd;AAAA,MAAA;AAII,YAAA,UAAU,CAAC,UAAiB;AAChC,gBAAQ,IAAI,4BAA4B,SAAS,uBAAuB,MAAM,OAAO;AAGjF,YAAA,MAAM,QAAQ,SAAS,WAAW,KAAK,MAAM,QAAQ,SAAS,MAAM,GAAG;AACzE,kBAAQ,IAAI,2EAA2E;AAClF,eAAA,WAAW,OAAO,WAAW;AAAA,YAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,YAClC,OAAO;AAAA,YACP,SAAS;AAAA,UAAA,CACV;AAAA,QAAA,OACI;AACA,eAAA,WAAW,OAAO,WAAW;AAAA,YAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,YAClC,OAAO;AAAA,YACP,SAAS,8BAA8B,MAAM,OAAO;AAAA,UAAA,CACrD;AAAA,QACH;AAEQ;AACR,YAAI,CAAC,YAAY;AACf,kBAAQ,IAAI;AAAA,QACd;AAAA,MAAA;AAIU,kBAAA,QAAQ,KAAK,QAAQ,MAAM;AAC3B,kBAAA,QAAQ,KAAK,SAAS,OAAO;AAErC,UAAA;AAEG,aAAA,WAAW,OAAO,WAAW;AAAA,UAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO;AAAA,UACP,SAAS;AAAA,QAAA,CACV;AAGD,gBAAQ,IAAI,mEAAmE;AACnE,oBAAA,QAAQ,KAAK,SAAS;AAGjC,2BAAmB,WAAW,MAAM;AAClC,cAAI,CAAC,YAAY;AACf,oBAAQ,IAAI,mEAAmE;AAE3E,gBAAA;AAEM,sBAAA,KAAK,YAAY,KAAK,CAAC;AAC/B,sBAAQ,IAAI,sDAAsD;AACtD,0BAAA,QAAQ,KAAK,SAAS;AAE7B,mBAAA,WAAW,OAAO,WAAW;AAAA,gBAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,gBAClC,OAAO;AAAA,gBACP,SAAS;AAAA,cAAA,CACV;AAAA,qBACM,YAAY;AAEnB,sBAAQ,IAAI,qEAAqE;AAAA,YACnF;AAGA,uBAAW,MAAM;AACf,kBAAI,CAAC,YAAY;AACf,wBAAQ,IAAI,gDAAgD;AACpD;AACR,wBAAQ,IAAI;AAAA,cACd;AAAA,eACC,GAAI;AAAA,UACT;AAAA,WACC,GAAI;AAER,gBAAQ,IAAI,0EAA0E;AAAA,eAE/E,OAAO;AACN,gBAAA,MAAM,gDAAgD,KAAK;AAE9D,aAAA,WAAW,OAAO,WAAW;AAAA,UAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO;AAAA,UACP,SAAS,2BAA2B,iBAAiB,QAAQ,MAAM,UAAU,eAAe;AAAA,QAAA,CAC7F;AAEO;AACR,gBAAQ,KAAK;AAAA,MACf;AAAA,IAAA,CACD;AAAA,EACH;AAAA,EAEA,kBAAwB;AACtB,eAAW,CAAC,SAAS,KAAK,KAAK,kBAAkB;AAC/C,WAAK,YAAY,SAAS;AAAA,IAC5B;AAAA,EACF;AAAA,EAEA,qBAA+B;AAC7B,WAAO,MAAM,KAAK,KAAK,iBAAiB,KAAM,CAAA;AAAA,EAChD;AAAA,EAEA,iBAAiB,WAA4B;AACpC,WAAA,KAAK,iBAAiB,IAAI,SAAS;AAAA,EAC5C;AAAA,EAEA,eAAe,WAA4C;AAClD,WAAA,KAAK,iBAAiB,IAAI,SAAS;AAAA,EAC5C;AAAA,EAEQ,aAAa,gBAAwB,cAAuD;AAE9F,QAAA,aAAa,SAAS,GAAG,GAAG;AAC9B,YAAM,QAAQ,aAAa,KAAK,EAAE,MAAM,KAAK;AACtC,aAAA,EAAE,KAAK,MAAM,CAAC,GAAG,MAAM,MAAM,MAAM,CAAC;IAC7C;AAIA,UAAM,eAAe,QAAQ,IAAI,aAAa,gBAAgB,CAAC,QAAQ,IAAI;AAE3E,YAAQ,gBAAgB;AAAA,MACtB,KAAK;AACH,cAAM,UAAU,eAAe,KAAK,eAAe,MAAM,IAAI;AAC7D,eAAO,EAAE,KAAK,SAAS,MAAM,CAAC,OAAO,YAAY;MACnD,KAAK;AACH,cAAM,UAAU,eAAe,KAAK,eAAe,MAAM,IAAI;AAC7D,eAAO,EAAE,KAAK,SAAS,MAAM,CAAC,YAAY,EAAE;AAAA,MAC9C,KAAK;AAAA,MACL;AACE,cAAM,SAAS,eAAe,KAAK,eAAe,KAAK,IAAI;AAC3D,eAAO,EAAE,KAAK,QAAQ,MAAM,CAAC,OAAO,YAAY;IACpD;AAAA,EACF;AAAA,EAEQ,eAAe,SAAyB;AAC9C,UAAM,EAAE,SAAA,IAAa,QAAQ,eAAe;AACtC,UAAAC,MAAK,QAAQ,IAAI;AACjB,UAAAC,QAAO,QAAQ,MAAM;AACrB,UAAA,KAAK,QAAQ,IAAI;AAEjB,UAAA,YAAY,QAAQ,aAAa;AACvC,UAAM,iBAAiB,YAAY,GAAG,OAAO,SAAS;AAElD,QAAA;AAEI,YAAA,cAAc,YAAY,UAAU;AAC1C,YAAM,WAAW,SAAS,GAAG,WAAW,IAAI,OAAO,IAAI,EAAE,UAAU,QAAQ,EAAE,KAAK;AAClF,UAAI,UAAU;AAEZ,cAAM,YAAY,SAAS,MAAM,IAAI,EAAE,CAAC,EAAE;AAC1C,gBAAQ,IAAI,0BAA0B,OAAO,QAAQ,SAAS,EAAE;AAEhE,eAAO,UAAU,SAAS,GAAG,IAAI,IAAI,SAAS,MAAM;AAAA,MACtD;AAAA,aACO,OAAO;AACN,cAAA,KAAK,mCAAmC,OAAO,4CAA4C;AAAA,IACrG;AAGA,UAAM,cAAc,CAAA;AAEpB,QAAI,WAAW;AAEb,YAAM,eAAe,QAAQ,IAAI,cAAc,KAAK;AACpD,YAAM,kBAAkB,QAAQ,IAAI,mBAAmB,KAAK;AACtD,YAAA,UAAU,QAAQ,IAAI,SAAS,KAAKA,MAAK,KAAK,GAAG,QAAA,GAAW,WAAW,SAAS;AAChF,YAAA,eAAe,QAAQ,IAAI,cAAc,KAAKA,MAAK,KAAK,GAAG,QAAA,GAAW,WAAW,OAAO;AAElF,kBAAA;AAAA,QACVA,MAAK,KAAK,cAAc,UAAU,GAAG,OAAO,MAAM;AAAA,QAClDA,MAAK,KAAK,iBAAiB,UAAU,GAAG,OAAO,MAAM;AAAA,QACrDA,MAAK,KAAK,SAAS,OAAO,GAAG,OAAO,MAAM;AAAA,QAC1CA,MAAK,KAAK,cAAc,OAAO,GAAG,OAAO,MAAM;AAAA,QAC/CA,MAAK,KAAK,GAAG,WAAW,WAAW,WAAW,OAAO,GAAG,OAAO,MAAM;AAAA,MAAA;AAIjE,YAAA,UAAU,QAAQ,IAAI,UAAU;AACtC,UAAI,SAAS;AACX,oBAAY,KAAKA,MAAK,KAAK,SAAS,GAAG,OAAO,MAAM,CAAC;AAAA,MACvD;AAGM,YAAA,YAAY,QAAQ,IAAI,YAAY,KAAKA,MAAK,KAAK,GAAG,QAAQ,GAAG,QAAQ;AACnE,kBAAA,KAAKA,MAAK,KAAK,WAAW,OAAO,GAAG,OAAO,MAAM,CAAC;AAAA,IAAA,OAEzD;AAEL,YAAM,UAAU,QAAQ,IAAI,QAAQ,GAAG;AAC3B,kBAAA;AAAA,QACV,kBAAkB,OAAO;AAAA,QACzB,qBAAqB,OAAO;AAAA,QAC5B,YAAY,OAAO;AAAA,QACnB,GAAG,OAAO,eAAe,OAAO;AAAA,MAAA;AAIlC,UAAI,SAAS;AACP,YAAA;AAEF,gBAAM,SAASA,MAAK,KAAK,SAAS,QAAQ,YAAY,MAAM;AACxD,cAAAD,IAAG,WAAW,MAAM,GAAG;AACnB,kBAAA,WAAWA,IAAG,YAAY,MAAM;AACtC,uBAAW,WAAW,UAAU;AAC9B,oBAAM,UAAUC,MAAK,KAAK,QAAQ,SAAS,OAAO,OAAO;AACzD,0BAAY,KAAK,OAAO;AAAA,YAC1B;AAAA,UACF;AAAA,iBACO,OAAO;AACN,kBAAA,KAAK,8CAA8C,KAAK;AAAA,QAClE;AAEI,YAAA;AAEF,gBAAM,SAASA,MAAK,KAAK,SAAS,QAAQ,eAAe;AACrD,cAAAD,IAAG,WAAW,MAAM,GAAG;AACnB,kBAAA,WAAWA,IAAG,YAAY,MAAM;AACtC,uBAAW,WAAW,UAAU;AAC9B,oBAAM,UAAUC,MAAK,KAAK,QAAQ,SAAS,gBAAgB,OAAO,OAAO;AACzE,0BAAY,KAAK,OAAO;AAAA,YAC1B;AAAA,UACF;AAAA,iBACO,OAAO;AACN,kBAAA,KAAK,8CAA8C,KAAK;AAAA,QAClE;AAAA,MACF;AAAA,IACF;AAEA,eAAW,WAAW,aAAa;AAC7B,UAAA;AACE,YAAAD,IAAG,WAAW,OAAO,GAAG;AAC1B,kBAAQ,IAAI,0BAA0B,OAAO,QAAQ,OAAO,EAAE;AAE9D,iBAAO,QAAQ,SAAS,GAAG,IAAI,IAAI,OAAO,MAAM;AAAA,QAClD;AAAA,eACO,OAAO;AACd;AAAA,MACF;AAAA,IACF;AAGQ,YAAA,KAAK,iDAAiD,OAAO,0BAA0B;AAC/F,WAAO,YAAY,iBAAiB;AAAA,EACtC;AAAA,EAEQ,kBAAkB,WAAmB,cAAkC;;AAE7E,uBAAa,WAAb,mBAAqB,GAAG,QAAQ,CAAC,SAAS;AACxC,YAAM,UAAU,KAAK,SAAS,EAAE,KAAK;AACrC,UAAI,SAAS;AAEN,aAAA,kBAAkB,WAAW,OAAO;AAEpC,aAAA,WAAW,OAAO,WAAW;AAAA,UAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO;AAAA,UACP,SAAS,KAAK,gBAAgB,OAAO;AAAA,QAAA,CACtC;AAAA,MACH;AAAA,IAAA;AAIF,uBAAa,WAAb,mBAAqB,GAAG,QAAQ,CAAC,SAAS;AACxC,YAAM,UAAU,KAAK,SAAS,EAAE,KAAK;AACrC,UAAI,SAAS;AAEN,aAAA,kBAAkB,WAAW,OAAO;AAGzC,cAAM,QAAQ,KAAK,eAAe,OAAO,IAAI,UAAU;AAClD,aAAA,WAAW,OAAO,WAAW;AAAA,UAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC;AAAA,UACA,SAAS,KAAK,gBAAgB,OAAO;AAAA,QAAA,CACtC;AAAA,MACH;AAAA,IAAA;AAAA,EAEJ;AAAA,EAEQ,kBAAkB,WAAmB,SAAuB;AAC1D,YAAA,IAAI,wDAAwD,OAAO,GAAG;AAG9E,UAAM,cAAc;AAAA;AAAA,MAElB;AAAA;AAAA,MAEA;AAAA;AAAA,MAEA;AAAA;AAAA,MAEA;AAAA;AAAA,MAEA;AAAA;AAAA,MAEA;AAAA,IAAA;AAGF,eAAW,WAAW,aAAa;AAC3B,YAAA,QAAQ,QAAQ,MAAM,OAAO;AACnC,UAAI,OAAO;AACL,YAAA,MAAM,MAAM,CAAC;AACjB,gBAAQ,IAAI,sCAAsC,GAAG,oBAAoB,OAAO,EAAE;AAGlF,cAAM,IAAI,QAAQ,yBAAyB,EAAE,EAAE;AAG/C,YAAI,CAAC,IAAI,SAAS,GAAG,GAAG;AACf,iBAAA;AAAA,QACT;AAGM,cAAA,YAAY,IAAI,MAAM,QAAQ;AACpC,cAAM,OAAO,YAAY,SAAS,UAAU,CAAC,CAAC,IAAI;AAElD,gBAAQ,IAAI,6CAA6C,SAAS,KAAK,GAAG,WAAW,IAAI,EAAE;AAG3F,YAAI,KAAK,eAAe;AACd,kBAAA,IAAI,8DAA8D,SAAS,EAAE;AAChF,eAAA,cAAc,WAAW,KAAK,IAAI;AAAA,QAAA,OAClC;AACL,kBAAQ,IAAI,+CAA+C;AAAA,QAC7D;AAGK,aAAA,WAAW,OAAO,WAAW;AAAA,UAChC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,OAAO;AAAA,UACP,SAAS,kBAAkB,GAAG;AAAA,QAAA,CAC/B;AAED;AAAA,MACF;AAAA,IACF;AAEA,QAAI,CAAC,QAAQ,MAAM,qCAAqC;AAAG;AAAA,SAEpD;AACG,cAAA,IAAI,yDAAyD,OAAO,GAAG;AAAA,IACjF;AAAA,EACF;AAAA,EAKA,uBAAuB,UAAyE;AAC9F,SAAK,gBAAgB;AAAA,EACvB;AAAA,EAEQ,gBAAgB,SAAyB;AAExC,WAAA,QAAQ,QAAQ,mBAAmB,EAAE;AAAA,EAC9C;AAAA,EAEQ,eAAe,SAA0B;AAC/C,UAAM,gBAAgB,CAAC,SAAS,UAAU,aAAa,UAAU,QAAQ;AACnE,UAAA,eAAe,QAAQ;AAC7B,WAAO,cAAc,KAAK,CAAA,YAAW,aAAa,SAAS,OAAO,CAAC;AAAA,EACrE;AAAA,EAEQ,kBAA0B;AAC1B,UAAA,cAAc,QAAQ,IAAI,QAAQ;AAClC,UAAAA,MAAK,QAAQ,IAAI;AACjB,UAAAC,QAAO,QAAQ,MAAM;AACrB,UAAA,KAAK,QAAQ,IAAI;AAEjB,UAAA,YAAY,QAAQ,aAAa;AACjC,UAAA,gBAAgB,YAAY,MAAM;AAGxC,UAAM,kBAAkB,CAAA;AAExB,QAAI,WAAW;AAEb,YAAM,eAAe,QAAQ,IAAI,cAAc,KAAK;AACpD,YAAM,kBAAkB,QAAQ,IAAI,mBAAmB,KAAK;AACtD,YAAA,UAAU,QAAQ,IAAI,SAAS,KAAKA,MAAK,KAAK,GAAG,QAAA,GAAW,WAAW,SAAS;AAChF,YAAA,eAAe,QAAQ,IAAI,cAAc,KAAKA,MAAK,KAAK,GAAG,QAAA,GAAW,WAAW,OAAO;AAE9E,sBAAA;AAAA,QACdA,MAAK,KAAK,cAAc,QAAQ;AAAA,QAChCA,MAAK,KAAK,iBAAiB,QAAQ;AAAA,QACnCA,MAAK,KAAK,SAAS,KAAK;AAAA,QACxBA,MAAK,KAAK,cAAc,KAAK;AAAA,QAC7BA,MAAK,KAAK,GAAG,QAAW,GAAA,WAAW,WAAW,KAAK;AAAA,MAAA;AAI/C,YAAA,UAAU,QAAQ,IAAI,UAAU;AACtC,UAAI,SAAS;AACX,wBAAgB,KAAK,OAAO;AAAA,MAC9B;AAGM,YAAA,YAAY,QAAQ,IAAI,YAAY,KAAKA,MAAK,KAAK,GAAG,QAAQ,GAAG,QAAQ;AAC/E,sBAAgB,KAAKA,MAAK,KAAK,WAAW,KAAK,CAAC;AAAA,IAAA,OAE3C;AAEW,sBAAA;AAAA,QACd;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAIF,YAAM,UAAU,QAAQ,IAAI,QAAQ,GAAG;AACvC,UAAI,SAAS;AAEP,YAAA;AACF,gBAAM,SAASA,MAAK,KAAK,SAAS,QAAQ,YAAY,MAAM;AACxD,cAAAD,IAAG,WAAW,MAAM,GAAG;AACnB,kBAAA,WAAWA,IAAG,YAAY,MAAM;AACtC,uBAAW,WAAW,UAAU;AAC9B,oBAAM,UAAUC,MAAK,KAAK,QAAQ,SAAS,KAAK;AAC5C,kBAAAD,IAAG,WAAW,OAAO,GAAG;AAC1B,gCAAgB,KAAK,OAAO;AAAA,cAC9B;AAAA,YACF;AAAA,UACF;AAAA,iBACO,OAAO;AACN,kBAAA,KAAK,iDAAiD,KAAK;AAAA,QACrE;AAGgB,wBAAA,KAAK,GAAG,OAAO,aAAa;AAGxC,YAAA;AACF,gBAAM,SAASC,MAAK,KAAK,SAAS,QAAQ,eAAe;AACrD,cAAAD,IAAG,WAAW,MAAM,GAAG;AACnB,kBAAA,WAAWA,IAAG,YAAY,MAAM;AACtC,uBAAW,WAAW,UAAU;AAC9B,oBAAM,UAAUC,MAAK,KAAK,QAAQ,SAAS,gBAAgB,KAAK;AAC5D,kBAAAD,IAAG,WAAW,OAAO,GAAG;AAC1B,gCAAgB,KAAK,OAAO;AAAA,cAC9B;AAAA,YACF;AAAA,UACF;AAAA,iBACO,OAAO;AACN,kBAAA,KAAK,iDAAiD,KAAK;AAAA,QACrE;AAAA,MACF;AAAA,IACF;AAGA,UAAM,cAAc,CAAC,GAAO,oBAAA,IAAI,CAAC,GAAG,YAAY,MAAM,aAAa,GAAG,GAAG,eAAe,CAAC,CAAC,EACvF,OAAO,CAAW,YAAA;AACjB,UAAI,CAAC;AAAgB,eAAA;AACjB,UAAA;AACK,eAAAA,IAAG,WAAW,OAAO;AAAA,MAAA,QACtB;AACC,eAAA;AAAA,MACT;AAAA,IAAA,CACD;AAEG,UAAA,eAAe,YAAY,KAAK,aAAa;AAC3C,YAAA,IAAI,mCAAmC,YAAY,EAAE;AACtD,WAAA;AAAA,EACT;AACF;AC9mBO,MAAM,WAAW;AAAA,EAAjB;AACG,oDAAoC;AACpC,6CAAoB;AACpB;AAAA;AAAA,EAER,cAAc,QAA6B;AACzC,SAAK,aAAa;AAAA,EACpB;AAAA,EAEA,OAAO,WAAmB,UAA0B;AAClD,QAAI,CAAC,KAAK,KAAK,IAAI,SAAS,GAAG;AAC7B,WAAK,KAAK,IAAI,WAAW,CAAE,CAAA;AAAA,IAC7B;AAEA,UAAM,cAAc,KAAK,KAAK,IAAI,SAAS;AAC3C,gBAAY,KAAK,QAAQ;AAGrB,QAAA,YAAY,SAAS,KAAK,mBAAmB;AAC/C,kBAAY,MAAM;AAAA,IACpB;AAGK,SAAA,kBAAkB,WAAW,QAAQ;AAAA,EAC5C;AAAA,EAEA,cAAc,WAA+B;AAC3C,WAAO,KAAK,KAAK,IAAI,SAAS,KAAK,CAAA;AAAA,EACrC;AAAA,EAEA,mBAA+C;AAC7C,UAAM,SAAqC,CAAA;AAC3C,eAAW,CAAC,WAAW,IAAI,KAAK,KAAK,MAAM;AACzC,aAAO,SAAS,IAAI,CAAC,GAAG,IAAI;AAAA,IAC9B;AACO,WAAA;AAAA,EACT;AAAA,EAEA,iBAAiB,WAAyB;AACnC,SAAA,KAAK,OAAO,SAAS;AAG1B,QAAI,KAAK,cAAc,CAAC,KAAK,WAAW,eAAe;AACrD,WAAK,WAAW,YAAY,KAAK,gBAAgB,SAAS;AAAA,IAC5D;AAAA,EACF;AAAA,EAEA,eAAqB;AACnB,SAAK,KAAK;AAGV,QAAI,KAAK,cAAc,CAAC,KAAK,WAAW,eAAe;AAChD,WAAA,WAAW,YAAY,KAAK,iBAAiB;AAAA,IACpD;AAAA,EACF;AAAA,EAEA,YAAY,WAAwE;AAClF,UAAM,OAAO,KAAK,KAAK,IAAI,SAAS,KAAK;AAElC,WAAA;AAAA,MACL,OAAO,KAAK;AAAA,MACZ,QAAQ,KAAK,OAAO,SAAO,IAAI,UAAU,OAAO,EAAE;AAAA,MAClD,UAAU,KAAK,OAAO,SAAO,IAAI,UAAU,MAAM,EAAE;AAAA,IAAA;AAAA,EAEvD;AAAA;AAAA,EAGA,gBAAgB,WAAmB,QAAQ,IAAgB;AACzD,UAAM,OAAO,KAAK,KAAK,IAAI,SAAS,KAAK;AAClC,WAAA,KACJ,OAAO,CAAO,QAAA,IAAI,UAAU,OAAO,EACnC,MAAM,CAAC,KAAK;AAAA,EACjB;AAAA;AAAA,EAGA,WAAW,WAAmB,OAAe,OAAuC;AAClF,UAAM,OAAO,KAAK,KAAK,IAAI,SAAS,KAAK;AACnC,UAAA,aAAa,MAAM;AAElB,WAAA,KAAK,OAAO,CAAO,QAAA;AACxB,YAAM,eAAe,IAAI,QAAQ,YAAY,EAAE,SAAS,UAAU;AAClE,YAAM,eAAe,CAAC,SAAS,IAAI,UAAU;AAC7C,aAAO,gBAAgB;AAAA,IAAA,CACxB;AAAA,EACH;AAAA,EAEQ,kBAAkB,WAAmB,UAA0B;AACrE,QAAI,KAAK,cAAc,CAAC,KAAK,WAAW,eAAe;AAChD,WAAA,WAAW,YAAY,KAAK,iBAAiB;AAAA,QAChD;AAAA,QACA;AAAA,MAAA,CACD;AAAA,IACH;AAAA,EACF;AAAA;AAAA,EAGA,iBAA0F;AACxF,QAAI,YAAY;AAChB,QAAI,uBAAuB;AAE3B,eAAW,CAAC,WAAW,IAAI,KAAK,KAAK,MAAM;AACzC,mBAAa,KAAK;AAGlB,iBAAW,OAAO,MAAM;AACtB,gCAAwB,KAAK,UAAU,GAAG,EAAE,SAAS;AAAA,MACvD;AACA,8BAAwB,UAAU,SAAS;AAAA,IAC7C;AAEO,WAAA;AAAA,MACL,eAAe,KAAK,KAAK;AAAA,MACzB;AAAA,MACA,mBAAmB,KAAK,MAAM,uBAAuB,IAAI;AAAA,IAAA;AAAA,EAE7D;AAAA;AAAA,EAGA,mBAAmB,WAAyB;AACrC,SAAA,KAAK,OAAO,SAAS;AAAA,EAC5B;AACF;AC5GA,MAAM,iBAA4B;AAAA,EAChC,OAAO;AAAA,EACP,WAAW;AAAA,EACX,gBAAgB;AAAA,EAChB,mBAAmB;AAAA,EACnB,uBAAuB;AAAA,EACvB,uBAAuB;AAAA,EACvB,UAAU;AAAA,EACV,UAAU;AACZ;AAEO,MAAM,cAAc;AAAA,EAIzB,cAAc;AAHN;AACA;AAGN,SAAK,iBAAiBR,UAAKC,SAAAA,IAAI,QAAQ,UAAU,GAAG,iBAAiB;AAChE,SAAA,SAAS,KAAK;EACrB;AAAA,EAEQ,aAAwB;AAC1B,QAAA;AACE,UAAAC,GAAA,WAAW,KAAK,cAAc,GAAG;AACnC,cAAM,OAAOC,GAAA,aAAa,KAAK,gBAAgB,OAAO;AAChD,cAAA,cAAc,KAAK,MAAM,IAAI;AAGnC,eAAO,EAAE,GAAG,gBAAgB,GAAG;MAAY,OACtC;AACL,aAAK,WAAW,cAAc;AACvB,eAAA,EAAE,GAAG;MACd;AAAA,aACO,OAAO;AACN,cAAA,MAAM,0BAA0B,KAAK;AACtC,aAAA,EAAE,GAAG;IACd;AAAA,EACF;AAAA,EAEQ,WAAW,QAAyB;AACtC,QAAA;AACFC,uBAAc,KAAK,gBAAgB,KAAK,UAAU,QAAQ,MAAM,CAAC,CAAC;AAAA,aAC3D,OAAO;AACN,cAAA,MAAM,0BAA0B,KAAK;AAAA,IAC/C;AAAA,EACF;AAAA,EAEA,YAAuB;AACd,WAAA,EAAE,GAAG,KAAK;EACnB;AAAA,EAEA,aAAa,SAAwC;AACnD,SAAK,SAAS,EAAE,GAAG,KAAK,QAAQ,GAAG;AAC9B,SAAA,WAAW,KAAK,MAAM;AACpB,WAAA,EAAE,GAAG,KAAK;EACnB;AAAA,EAEA,cAAyB;AAClB,SAAA,SAAS,EAAE,GAAG;AACd,SAAA,WAAW,KAAK,MAAM;AACpB,WAAA,EAAE,GAAG,KAAK;EACnB;AAAA;AAAA,EAGA,WAA+B;AAC7B,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA,EAEA,2BAA+D;AAC7D,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA,EAEA,2BAAmC;AACjC,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA,EAEA,cAAqC;AACnC,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA;AAAA,EAGA,SAAS,OAAiC;AACnC,SAAA,aAAa,EAAE,MAAA,CAAO;AAAA,EAC7B;AAAA,EAEA,yBAAyB,gBAA0D;AACjF,SAAK,aAAa,EAAE,uBAAuB,eAAgB,CAAA;AAAA,EAC7D;AAAA,EAEA,gBAAgB,QAAyC;AACvD,SAAK,aAAa,EAAE,cAAc,OAAQ,CAAA;AAAA,EAC5C;AAAA,EAEA,YAAY,UAAuC;AAC5C,SAAA,aAAa,EAAE,SAAA,CAAU;AAAA,EAChC;AAAA;AAAA,EAGA,eAAe,QAAkE;AAC/E,UAAM,SAAmB,CAAA;AAErB,QAAA,OAAO,SAAS,CAAC,CAAC,SAAS,QAAQ,QAAQ,EAAE,SAAS,OAAO,KAAK,GAAG;AACvE,aAAO,KAAK,qBAAqB;AAAA,IACnC;AAEI,QAAA,OAAO,yBAAyB,CAAC,CAAC,OAAO,QAAQ,MAAM,EAAE,SAAS,OAAO,qBAAqB,GAAG;AACnG,aAAO,KAAK,yBAAyB;AAAA,IACvC;AAEA,QAAI,OAAO,0BAA0B,OAAO,wBAAwB,KAAK,OAAO,wBAAwB,KAAK;AAC3G,aAAO,KAAK,kDAAkD;AAAA,IAChE;AAEI,QAAA,OAAO,YAAY,CAAC,CAAC,SAAS,OAAO,EAAE,SAAS,OAAO,QAAQ,GAAG;AACpE,aAAO,KAAK,kBAAkB;AAAA,IAChC;AAEI,QAAA,OAAO,YAAY,CAAC,CAAC,QAAQ,QAAQ,OAAO,EAAE,SAAS,OAAO,QAAQ,GAAG;AAC3E,aAAO,KAAK,mBAAmB;AAAA,IACjC;AAEO,WAAA;AAAA,MACL,OAAO,OAAO,WAAW;AAAA,MACzB;AAAA,IAAA;AAAA,EAEJ;AAAA;AAAA,EAGA,eAAuB;AACrB,WAAO,KAAK,UAAU,KAAK,QAAQ,MAAM,CAAC;AAAA,EAC5C;AAAA;AAAA,EAGA,aAAa,YAA0D;AACjE,QAAA;AACI,YAAA,iBAAiB,KAAK,MAAM,UAAU;AACtC,YAAA,aAAa,KAAK,eAAe,cAAc;AAEjD,UAAA,CAAC,WAAW,OAAO;AACd,eAAA;AAAA,UACL,SAAS;AAAA,UACT,OAAO,0BAA0B,WAAW,OAAO,KAAK,IAAI,CAAC;AAAA,QAAA;AAAA,MAEjE;AAEA,WAAK,SAAS,EAAE,GAAG,gBAAgB,GAAG,eAAe;AAChD,WAAA,WAAW,KAAK,MAAM;AAEpB,aAAA,EAAE,SAAS;aACX,OAAO;AACP,aAAA;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAAA;AAAA,IAEpD;AAAA,EACF;AACF;ACxKA,IAAI;AACJ,IAAI;AACJ,IAAI;AACJ,IAAI;AAGJ,IAAI,aAAmC;AAEvC,MAAM,QAAQ,QAAQ,IAAI,aAAa;AAEvC,SAAS,eAAe;;AAEtB,QAAM,SAAS,gBAAgB,cAAc,UAAA,IAAc;AAE3D,eAAa,IAAIM,SAAAA,cAAc;AAAA,IAC7B,SAAO,sCAAQ,iBAAR,mBAAsB,UAAS;AAAA,IACtC,UAAQ,sCAAQ,iBAAR,mBAAsB,WAAU;AAAA,IACxC,IAAG,sCAAQ,iBAAR,mBAAsB;AAAA,IACzB,IAAG,sCAAQ,iBAAR,mBAAsB;AAAA,IACzB,UAAU;AAAA,IACV,WAAW;AAAA,IACX,gBAAgB;AAAA,MACd,iBAAiB;AAAA,MACjB,kBAAkB;AAAA,MAClB,SAASV,KAAAA,KAAK,WAAW,YAAY;AAAA,IACvC;AAAA,IACA,eAAe;AAAA,IACf,MAAM;AAAA,EAAA,CACP;AAGD,MAAI,OAAO;AACT,eAAW,QAAQ,uBAAuB;AAC1C,eAAW,YAAY;EAAa,OAC/B;AACL,eAAW,SAASA,KAAAA,KAAK,WAAW,oBAAoB,CAAC;AAAA,EAC3D;AAGW,aAAA,KAAK,iBAAiB,MAAM;AACrC,6CAAY;AAAA,EAAK,CAClB;AAGU,aAAA,GAAG,SAAS,MAAM;AAC3B,QAAI,cAAc,eAAe;AACzB,YAAA,SAAS,WAAW;AAC1B,oBAAc,aAAa;AAAA,QACzB,cAAc;AAAA,MAAA,CACf;AAAA,IACH;AAAA,EAAA,CACD;AAEU,aAAA,GAAG,UAAU,MAAM;AACf,iBAAA;AAAA,EAAA,CACd;AACH;AAGA,SAAS,qBAAqB;AAC5B,kBAAgB,IAAI;AACpB,mBAAiB,IAAI;AACrB,eAAa,IAAI;AACA,mBAAA,IAAI,eAAe,UAAU;AAG9C,iBAAe,uBAAuB,CAAC,WAAmB,KAAa,SAAkB;AACvF,YAAQ,IAAI,mCAAmC,SAAS,KAAK,GAAG,EAAE;AAClE,mBAAe,cAAc,WAAW;AAAA,MACtC;AAAA,MACA;AAAA,IAAA,CACD;AAAA,EAAA,CACF;AAGc,iBAAA,+BAA+B,CAAC,WAAmB,WAAkC;AAClG,YAAQ,IAAI,oCAAoC,SAAS,KAAK,MAAM,EAAE;AACtE,QAAI,WAAW,WAAW;AACxB,qBAAe,cAAc,WAAW;AAAA,QACtC,QAAQ;AAAA,QACR,KAAK;AAAA,QACL,KAAK;AAAA,QACL,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,EAAA,CACD;AAID,iBAAe,0BAA0B;AAC3C;AAGA,SAAS,mBAAmB;AAE1BW,WAAA,QAAQ,OAAO,mBAAmB,MAAM,eAAe,eAAgB,CAAA;AAC/DA,mBAAA,OAAO,mBAAmB,CAAC,GAAG,gBAAgB,eAAe,cAAc,WAAW,CAAC;AACvFA,WAAAA,QAAA,OAAO,mBAAmB,CAAC,GAAG,IAAI,YAAY,eAAe,cAAc,IAAI,OAAO,CAAC;AACvFA,mBAAA,OAAO,mBAAmB,CAAC,GAAG,OAAO,eAAe,cAAc,EAAE,CAAC;AAC7EA,WAAA,QAAQ,OAAO,uBAAuB,MAAM,eAAe,mBAAoB,CAAA;AAG/EA,WAAAA,QAAQ,OAAO,kBAAkB,OAAO,GAAG,OAAO;AAC1C,UAAA,UAAU,eAAe,WAAW,EAAE;AAC5C,QAAI,CAAC;AAAS,aAAO,EAAE,SAAS,OAAO,OAAO,oBAAoB;AAElE,UAAM,SAAS,MAAM,eAAe,aAAa,OAAO;AACxD,QAAI,OAAO,SAAS;AAClB,qBAAe,cAAc,IAAI;AAAA,QAC/B,QAAQ;AAAA,QACR,KAAK,OAAO;AAAA,MAAA,CACb;AAAA,IACH;AACO,WAAA;AAAA,EAAA,CACR;AAEDA,WAAAA,QAAQ,OAAO,iBAAiB,OAAO,GAAG,OAAO;AACvC,YAAA,IAAI,sCAAsC,EAAE;AACpD,UAAM,UAAU,MAAM,eAAe,YAAY,EAAE;AAC3C,YAAA,IAAI,4CAA4C,OAAO;AAE/D,QAAI,SAAS;AACX,cAAQ,IAAI,0CAA0C;AACtD,qBAAe,cAAc,IAAI;AAAA,QAC/B,QAAQ;AAAA,QACR,KAAK;AAAA,MAAA,CACN;AACD,cAAQ,IAAI,2CAA2C;AAAA,IAAA,OAClD;AACL,cAAQ,IAAI,mDAAmD;AAAA,IACjE;AAEQ,YAAA,IAAI,4BAA4B,OAAO;AACxC,WAAA;AAAA,EAAA,CACR;AAEDA,WAAAA,QAAQ,OAAO,sBAAsB,CAAC,GAAG,OAAO;AACxC,UAAA,UAAU,eAAe,WAAW,EAAE;AACrC,WAAA,UAAU,QAAQ,SAAS;AAAA,EAAA,CACnC;AAGOA,mBAAA,OAAO,sBAAsB,CAAC,GAAG,cAAc,WAAW,cAAc,SAAS,CAAC;AAC1FA,WAAA,QAAQ,OAAO,iBAAiB,MAAM,WAAW,aAAc,CAAA;AACvDA,mBAAA,OAAO,cAAc,CAAC,GAAG,cAAc,WAAW,iBAAiB,SAAS,CAAC;AAGrFA,WAAA,QAAQ,OAAO,cAAc,MAAM,cAAc,UAAW,CAAA;AACpDA,mBAAA,OAAO,iBAAiB,CAAC,GAAG,YAAY,cAAc,aAAa,OAAO,CAAC;AACnFA,WAAA,QAAQ,OAAO,gBAAgB,MAAM,cAAc,YAAa,CAAA;AAGxDA,mBAAA,OAAO,uBAAuB,YAAY;AAChD,QAAI,CAAC;AAAmB,aAAA;AAExB,UAAM,SAAS,MAAMC,gBAAO,eAAe,YAAY;AAAA,MACrD,YAAY,CAAC,eAAe;AAAA,MAC5B,OAAO;AAAA,IAAA,CACR;AAED,WAAO,OAAO,WAAW,OAAO,OAAO,UAAU,CAAC;AAAA,EAAA,CACnD;AAGDD,WAAAA,QAAQ,OAAO,qBAAqB,OAAO,GAAG,eAAe;AACvD,QAAA;AACI,YAAAE,SAAA,MAAM,SAAS,UAAU;AACxB,aAAA,EAAE,SAAS;aACX,OAAO;AACN,cAAA,MAAM,0BAA0B,KAAK;AACtC,aAAA,EAAE,SAAS,OAAO,OAAO,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK,EAAE;AAAA,IACzF;AAAA,EAAA,CACD;AACH;AAGAZ,SAAAA,IAAI,UAAA,EAAY,KAAK,MAAM;AACN;AACF;AACJ;AAGb,MAAI,cAAc,YAAY;AAC5B,eAAW,cAAc,UAAU;AAAA,EACrC;AAEIA,eAAA,GAAG,YAAY,MAAM;AACvB,QAAIS,uBAAc,gBAAgB,WAAW,GAAG;AACjC;IACf;AAAA,EAAA,CACD;AACH,CAAC;AAEDT,SAAAA,IAAI,GAAG,qBAAqB,MAAM;AAEhC,MAAI,gBAAgB;AAClB,mBAAe,gBAAgB;AAAA,EACjC;AAEI,MAAA,QAAQ,aAAa,UAAU;AACjCA,aAAA,IAAI,KAAK;AAAA,EACX;AACF,CAAC;AAEDA,SAAAA,IAAI,GAAG,eAAe,MAAM;AAE1B,MAAI,gBAAgB;AAClB,mBAAe,gBAAgB;AAAA,EACjC;AACF,CAAC;"}